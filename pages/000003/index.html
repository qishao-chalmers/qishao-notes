<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Getting Started with LLVM Core Libraries-Notes Chap6 Backend | CPU &amp; GPU Microarch. Qi Shao</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="stylesheet" href="custom.css">
    <script language="javascript" type="text/javascript" src="/qishao-notes/js/pgmanor-self.js"></script>
    <meta name="description" content="Computer System">
    <meta name="google-site-verification" content="66w5U9NY5gJWu7iBtHKMbhpXkV94jy31L_RHbvrZZzY">
    <meta name="keywords" content="Hitqishao,golang,vue,go-web,go-admin,go-ldap-admin">
    <meta name="theme-color" content="#11a8cd">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <link rel="preload" href="/qishao-notes/assets/css/0.styles.922e50b3.css" as="style"><link rel="preload" href="/qishao-notes/assets/js/app.060b0fa6.js" as="script"><link rel="preload" href="/qishao-notes/assets/js/2.75973713.js" as="script"><link rel="preload" href="/qishao-notes/assets/js/24.ae95a93e.js" as="script"><link rel="prefetch" href="/qishao-notes/assets/js/10.da77fffe.js"><link rel="prefetch" href="/qishao-notes/assets/js/11.68f10fb9.js"><link rel="prefetch" href="/qishao-notes/assets/js/12.97db4364.js"><link rel="prefetch" href="/qishao-notes/assets/js/13.117c9063.js"><link rel="prefetch" href="/qishao-notes/assets/js/14.31d2015b.js"><link rel="prefetch" href="/qishao-notes/assets/js/15.301a02ce.js"><link rel="prefetch" href="/qishao-notes/assets/js/16.1544c7aa.js"><link rel="prefetch" href="/qishao-notes/assets/js/17.be625961.js"><link rel="prefetch" href="/qishao-notes/assets/js/18.7ae41e76.js"><link rel="prefetch" href="/qishao-notes/assets/js/19.c41dccff.js"><link rel="prefetch" href="/qishao-notes/assets/js/20.f4150fdb.js"><link rel="prefetch" href="/qishao-notes/assets/js/21.b5ba1720.js"><link rel="prefetch" href="/qishao-notes/assets/js/22.aec55c0f.js"><link rel="prefetch" href="/qishao-notes/assets/js/23.00322b09.js"><link rel="prefetch" href="/qishao-notes/assets/js/25.e5add587.js"><link rel="prefetch" href="/qishao-notes/assets/js/26.9a920fc3.js"><link rel="prefetch" href="/qishao-notes/assets/js/27.e8d36ebd.js"><link rel="prefetch" href="/qishao-notes/assets/js/28.07f576d2.js"><link rel="prefetch" href="/qishao-notes/assets/js/29.2eae07d2.js"><link rel="prefetch" href="/qishao-notes/assets/js/3.30693845.js"><link rel="prefetch" href="/qishao-notes/assets/js/30.dbac792d.js"><link rel="prefetch" href="/qishao-notes/assets/js/31.887d10e5.js"><link rel="prefetch" href="/qishao-notes/assets/js/32.87750de9.js"><link rel="prefetch" href="/qishao-notes/assets/js/33.19f8db5c.js"><link rel="prefetch" href="/qishao-notes/assets/js/34.ffcf141e.js"><link rel="prefetch" href="/qishao-notes/assets/js/35.d949676c.js"><link rel="prefetch" href="/qishao-notes/assets/js/36.613f8a8d.js"><link rel="prefetch" href="/qishao-notes/assets/js/37.dc096ab8.js"><link rel="prefetch" href="/qishao-notes/assets/js/38.315b16eb.js"><link rel="prefetch" href="/qishao-notes/assets/js/39.17867061.js"><link rel="prefetch" href="/qishao-notes/assets/js/4.424759af.js"><link rel="prefetch" href="/qishao-notes/assets/js/40.1713c1eb.js"><link rel="prefetch" href="/qishao-notes/assets/js/41.533a2027.js"><link rel="prefetch" href="/qishao-notes/assets/js/42.65eea2dd.js"><link rel="prefetch" href="/qishao-notes/assets/js/43.985d82ad.js"><link rel="prefetch" href="/qishao-notes/assets/js/44.384025ae.js"><link rel="prefetch" href="/qishao-notes/assets/js/45.6d44deb0.js"><link rel="prefetch" href="/qishao-notes/assets/js/46.6c9b609b.js"><link rel="prefetch" href="/qishao-notes/assets/js/47.6baaaff0.js"><link rel="prefetch" href="/qishao-notes/assets/js/48.a8d0ad6a.js"><link rel="prefetch" href="/qishao-notes/assets/js/49.4ce55108.js"><link rel="prefetch" href="/qishao-notes/assets/js/5.1d4e5a23.js"><link rel="prefetch" href="/qishao-notes/assets/js/50.faf2bf0d.js"><link rel="prefetch" href="/qishao-notes/assets/js/51.ebbd222e.js"><link rel="prefetch" href="/qishao-notes/assets/js/52.590ff1b9.js"><link rel="prefetch" href="/qishao-notes/assets/js/53.c2d29737.js"><link rel="prefetch" href="/qishao-notes/assets/js/54.4692bc81.js"><link rel="prefetch" href="/qishao-notes/assets/js/55.30e77a23.js"><link rel="prefetch" href="/qishao-notes/assets/js/56.afbb76f5.js"><link rel="prefetch" href="/qishao-notes/assets/js/57.37fcec5f.js"><link rel="prefetch" href="/qishao-notes/assets/js/58.e754f2eb.js"><link rel="prefetch" href="/qishao-notes/assets/js/59.537ec080.js"><link rel="prefetch" href="/qishao-notes/assets/js/6.938d7909.js"><link rel="prefetch" href="/qishao-notes/assets/js/60.66922ad7.js"><link rel="prefetch" href="/qishao-notes/assets/js/7.bd09a0eb.js"><link rel="prefetch" href="/qishao-notes/assets/js/8.316deedd.js"><link rel="prefetch" href="/qishao-notes/assets/js/9.3863430d.js">
    <link rel="stylesheet" href="/qishao-notes/assets/css/0.styles.922e50b3.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/qishao-notes/" class="home-link router-link-active"><!----> <span class="site-name">CPU &amp; GPU Microarch. Qi Shao</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/qishao-notes/" class="nav-link">Home</a></div><div class="nav-item"><a href="/qishao-notes/hbm/" class="nav-link">hbm</a></div><div class="nav-item"><a href="/qishao-notes/compiler/" class="nav-link">compiler</a></div><div class="nav-item"><a href="/qishao-notes/gpu/" class="nav-link">gpu</a></div><div class="nav-item"><a href="/qishao-notes/cpu/" class="nav-link">cpu</a></div><div class="nav-item"><a href="/qishao-notes/llm/" class="nav-link">llm</a></div><div class="nav-item"><a href="/qishao-notes/unix/" class="nav-link">unix</a></div><div class="nav-item"><a href="/qishao-notes/message-board/" class="nav-link">BBS</a></div><div class="nav-item"><a href="https://blog.csdn.net/hit_shaoqi" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/hitqshao/qishao-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/qishao-notes/" class="nav-link">Home</a></div><div class="nav-item"><a href="/qishao-notes/hbm/" class="nav-link">hbm</a></div><div class="nav-item"><a href="/qishao-notes/compiler/" class="nav-link">compiler</a></div><div class="nav-item"><a href="/qishao-notes/gpu/" class="nav-link">gpu</a></div><div class="nav-item"><a href="/qishao-notes/cpu/" class="nav-link">cpu</a></div><div class="nav-item"><a href="/qishao-notes/llm/" class="nav-link">llm</a></div><div class="nav-item"><a href="/qishao-notes/unix/" class="nav-link">unix</a></div><div class="nav-item"><a href="/qishao-notes/message-board/" class="nav-link">BBS</a></div><div class="nav-item"><a href="https://blog.csdn.net/hit_shaoqi" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/hitqshao/qishao-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/qishao-notes/pages/000001/" class="sidebar-link">llvm front end</a></li><li><a href="/qishao-notes/pages/000002/" class="sidebar-link">Getting Started with LLVM Core Libraries-Notes Chap5 IR</a></li><li><a href="/qishao-notes/pages/000003/" aria-current="page" class="active sidebar-link">Getting Started with LLVM Core Libraries-Notes Chap6 Backend</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/qishao-notes/pages/000004/" class="sidebar-link">Learning LLVM Diary 00</a></li><li><a href="/qishao-notes/pages/000005/" class="sidebar-link">Add New Instruction &quot;ACE&quot; to LLVM</a></li><li><a href="/qishao-notes/pages/000006/" class="sidebar-link">How does LLVM perform instruction combine</a></li><li><a href="/qishao-notes/pages/000007/" class="sidebar-link">Understand llvm with its source code Part 1</a></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/qishao-notes/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/qishao-notes/compiler/#compiler" data-v-06225672>compiler</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/hitqshao" target="_blank" title="作者" class="beLink" data-v-06225672>hitqishao</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-11-21</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">Getting Started with LLVM Core Libraries-Notes Chap6 Backend<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h3 id="chap6-the-backend"><a href="#chap6-the-backend" class="header-anchor">#</a> Chap6. The Backend</h3> <p><img src="https://github.com/hitqshao/qishao-notes/assets/23403286/a5566aac-5d9f-40c4-810b-ec6572a3e94f" alt="image"></p> <p><strong>White box</strong> Essential
<strong>Gray Block</strong> For generated code efficiency</p> <h4 id="_1-instructon-selection"><a href="#_1-instructon-selection" class="header-anchor">#</a> 1. Instructon Selection<br></h4> <ul><li>Convert IR to target-specific SelectionDAG(Directed Acyclic Graph)
<ul><li>Block-&gt;DAG</li> <li>Instruction-&gt;Node</li> <li>Edge contains dataflow dependence and control dependence and glue.</li></ul></li> <li>LLVM use DAG to employ tree-based pattern-matching instruction selection.</li> <li>IN the end of this phase, IR node are converted to target-machine(machine instructions) nodes.</li></ul> <h4 id="_2-pre-register-allocation-ra-scheduling-the-first-instruction-scheduling"><a href="#_2-pre-register-allocation-ra-scheduling-the-first-instruction-scheduling" class="header-anchor">#</a> 2. Pre-register Allocation(RA) scheduling,the first instruction scheduling.<br></h4> <ul><li>This is to explore instruction-level parallelism</li> <li>The instructions are converted to MachineInstr three-address representation.</li></ul> <h4 id="_3-reguster-allocation"><a href="#_3-reguster-allocation" class="header-anchor">#</a> 3. Reguster Allocation<br></h4> <h4 id="_4-post-register-allocation-ra-instruction-scheduling-the-second-instruction-scheduling"><a href="#_4-post-register-allocation-ra-instruction-scheduling-the-second-instruction-scheduling" class="header-anchor">#</a> 4. Post-register Allocation(RA) Instruction Scheduling, the second instruction scheduling</h4> <ul><li>Now we have real register information, we can combine information of extra hazards and delays of real register to opmitize code.</li></ul> <h4 id="_5-code-emission"><a href="#_5-code-emission" class="header-anchor">#</a> 5. Code Emission</h4> <ul><li>Convert MachineInstr to MCInst</li> <li>Emit Assembly Code</li> <li>Emit Binary blobs to object code format</li></ul> <h3 id="_1-using-the-backend-tools"><a href="#_1-using-the-backend-tools" class="header-anchor">#</a> 1. Using the backend tools</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>llc *bc -o *.s
llc *.bc -filetype=obj -o *.o

llc *.bc -march=mips -filetype=obj -o *.o

// how march options
llc -version
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_2-learning-backend-struture"><a href="#_2-learning-backend-struture" class="header-anchor">#</a> 2. Learning backend struture</h3> <ul><li>CodeGen: Instruction selection, scheduler,register allocation</li> <li>MC: assembly parser, disassembler</li> <li>TableGen</li> <li>Target/*.cpp *.h *.td</li></ul> <p>Notice:</p> <p><strong>IselLowering is for Selection DAG Node lowering</strong> <br> <strong>IselDAGtoDAG is for instruction selection.</strong> <br></p> <p>TargetLowering is called first for target-specific <strong>call</strong> and <strong>ret</strong>.<br>
The major instruction selection is in ISelDAGtoDAG.</p> <p><img src="https://github.com/hitqshao/qishao-notes/assets/23403286/723f687b-0303-4add-89ea-5fe88676049c" alt="image"></p> <h3 id="_3-knowing-backend-libraries"><a href="#_3-knowing-backend-libraries" class="header-anchor">#</a> 3. Knowing backend libraries</h3> <ul><li><Target>AsmParser.a
</Target></li> <li><Target>AsmPrinter.a
</Target></li> <li><Target>CodeGen.a
<ul><li>majority of the target-dependent functionality of the backend, as following：</li> <li>specific register handling rules, instruction selection, and scheduling</li></ul></Target></li> <li><Target>Desc.a
<ul><li>low-level MC infrastructure and is responsible for registering target-specific MC objects such as MCCodeEmitter</li></ul></Target></li> <li><Target>Info.a
</Target></li> <li><Target>Disassembler.a
</Target></li></ul> <h3 id="_4-learning-how-to-use-tablegen-for-llvm-backends"><a href="#_4-learning-how-to-use-tablegen-for-llvm-backends" class="header-anchor">#</a> 4. Learning how to use TableGen for LLVM backends</h3> <ul><li>instruction formats,</li> <li>instructions,</li> <li>registers,</li> <li>pattern-matching DAGs,</li> <li>instruction selection matching order,</li> <li>calling conventions,</li> <li>target CPU properties (supported Instruction Set Architecture (ISA) features and processor families).</li></ul> <p>insns.td</p> <p><img src="https://github.com/hitqshao/qishao-notes/assets/23403286/e85b4512-f6d2-475d-bb4b-7fdb6a2bf8e8" alt="image"></p> <p>Generate code using llvm-tblgen</p> <p><img src="https://github.com/hitqshao/qishao-notes/assets/23403286/843b44f4-7d07-470d-85f8-5ff7c3aa167d" alt="image"></p> <p><strong>Target Properties: <Target>.td</Target></strong><br> <strong>Registers: <Target>RegisterInfo.td</Target></strong> <br></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ cd &lt;llvm_source&gt;/lib/Target/X86
$ llvm-tblgen -gen-register-info X86.td -I ../../../include
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>Instruction format: <Target>InstrFormat.td</Target></strong> <br> <strong>Instructions: <Target>InstrInfo.td</Target></strong> <br></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>include/llvm/Target/Target.td
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://github.com/hitqshao/qishao-notes/assets/23403286/89ae29d2-9a4d-4466-98a9-c1af119fb056" alt="image"></p> <p>dag in the above picture represents selectDAG for opcodes, registers or constants during instruction selection phase.<br></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>SparcInstrInfo.td
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://github.com/hitqshao/qishao-notes/assets/23403286/6b733913-3755-4a66-acb0-a78958033216" alt="image"></p> <p>We can get how the template parameters are assigned to class Instruction.</p> <ul><li>OutOperandList</li> <li>InOperandList</li> <li>AsmString</li> <li>Pattern</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>cd &lt;llvm_sources&gt;/lib/Target/Sparc
llvm-tblgen -print-records Sparc.td -I ../../../include | grep XNORrr -A 10
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>The difference between the first and second need to be checked.</strong></p> <ul><li><Target>GenDAGISel.inc 
</Target></li> <li><Target>GenInstrInfo.inc
</Target></li> <li><Target>GenAsmWriter.inc
</Target></li> <li><Target>GenCodeEmitter.inc
</Target></li> <li><Target>GenDisassemblerTables.inc
</Target></li> <li><Target>GenAsmMatcher.inc
</Target></li></ul> <h3 id="_5-instruction-selection-phase"><a href="#_5-instruction-selection-phase" class="header-anchor">#</a> 5. Instruction Selection Phase</h3> <p>LLVM IR -&gt; SelectionDAG(SDNode)</p> <ol><li>Create DAG, in which node carry IR op</li> <li>Nodes go through lowering, DAG combiner, and legalization phases.</li> <li>Instruction selection perform DAG-to-DAG conversion, using node pattern matching and transforms SelectionDAG node into nodes representing target instructions.</li></ol> <p><strong>Most expensive ones in backend</strong></p> <h4 id="_5-1-selectiondag-class"><a href="#_5-1-selectiondag-class" class="header-anchor">#</a> 5.1 SelectionDAG class</h4> <ul><li>DAG for each basic block</li> <li>SDNode for instruction or operand</li></ul> <p><img src="https://github.com/hitqshao/qishao-notes/assets/23403286/db628254-20e9-4df5-9748-cea3770dd65a" alt="image"></p> <ul><li>The black arrows represent regular edges showing a dataflow dependence.</li> <li>The dashed blue arrows represent non-dataflow chains that exist to enforce order between two otherwise unrelated instructions.</li> <li>The red edge guarantees that its adjacent nodes must be glued together</li></ul> <p>Please notice:</p> <ul><li>CopyFromReg: This is for getting value out of scope.</li> <li>CopyToReg: <strong>This node copies a value to a specific register without supplying any concrete value for other nodes to consume.</strong></li></ul> <h3 id="_6-lowering"><a href="#_6-lowering" class="header-anchor">#</a> 6. Lowering</h3> <p><img src="https://github.com/hitqshao/qishao-notes/assets/23403286/7c647ecf-0ad6-4540-896c-fc2da6c760c5" alt="image"></p> <ol><li><strong>SelectionDAGBuilder</strong> in <strong>SelectionDAGIsel.cpp</strong> visits every fuction and creates <strong>SelectionDAG</strong> for each basic block</li> <li>During 1), special IR such as call and ret needs <strong>TargetLowering</strong> class for the first time for info like: pass call arg and how to return.</li> <li>Only a smalle subset are lowered in this way. Majority are matched and replaces at <strong>instruction selection.</strong></li></ol> <blockquote><p>For instance, in SelectionDAG from sum.bc, the X86TargetLowering::LowerReturn() method (see lib/Target/X86/X86ISelLowering.cpp) is used to lower the IR ret instruction.<br>
While doing this, it generates the X86ISD::RET_FLAG node, which copies the function result to EAX a-target-specific way to handle the function return.</p></blockquote> <h3 id="_7-dag-combine-and-legalization"><a href="#_7-dag-combine-and-legalization" class="header-anchor">#</a> 7. DAG Combine and legalization</h3> <ul><li>DAG Combine
<ul><li>Optimization for simpler code</li> <li>Target Independent: lib/CodeGen/SelectionDAG/DAGCombiner.cpp</li> <li>Target Dependnet: lib/Target/&lt;Target_Name&gt;/<Target>ISelLowering.cpp setTargetDAGCombine()</Target></li></ul></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>setTargetDAGCombine({ISD::SDIVREM, ISD::UDIVREM, ISD::SELECT, ISD::AND,
                       ISD::OR, ISD::ADD, ISD::SUB, ISD::AssertZext, ISD::SHL});

static SDValue performADDCombine(SDNode *N, SelectionDAG &amp;DAG,
                                 TargetLowering::DAGCombinerInfo &amp;DCI,
                                 const MipsSubtarget &amp;Subtarget) {
  ...
  // (add v0, (add v1, abs_lo(tjt))) =&gt; (add (add v0, v1), abs_lo(tjt))
  SDValue Add = N-&gt;getOperand(1);

  if (Add.getOpcode() != ISD::ADD)
    return SDValue();

  SDValue Lo = Add.getOperand(1);
  ...
  EVT ValTy = N-&gt;getValueType(0);
  SDLoc DL(N);

  SDValue Add1 = DAG.getNode(ISD::ADD, DL, ValTy, N-&gt;getOperand(0),
                             Add.getOperand(0));
  return DAG.getNode(ISD::ADD, DL, ValTy, Add1, Lo);
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><ul><li>Legalization</li></ul> <ul><li>Support legal types: scalar: promote, expand, soften. vec split, scalarized or widened</li> <li>Also it can be customized</li></ul> <p><strong>Promote</strong> <br> <strong>Expand(library call)</strong> <br> <strong>Custom</strong></p> <p><img src="https://github.com/hitqshao/qishao-notes/assets/23403286/608efd69-88b3-45ca-b854-b9077c5853db" alt="image"></p> <h3 id="_8-dag-to-dag-instruction-selection"><a href="#_8-dag-to-dag-instruction-selection" class="header-anchor">#</a> 8. DAG-to-DAG instruction selection</h3> <p>Transform target-independent nodes to target-specific nodes by using pattern matching.</p> <p><strong>CopyToReg, CopyFromReg and Register</strong> nodes are untouched until <strong>Register Allocation</strong>.
<img src="https://github.com/hitqshao/qishao-notes/assets/23403286/e7221d4d-3e7d-4d32-bdb9-4c4d07c22b76" alt="image"></p> <h4 id="_8-1-pattern-matching"><a href="#_8-1-pattern-matching" class="header-anchor">#</a> 8.1 Pattern Matching</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>lib/Target/Sparc/SparcISelDAGToDAG.cpp

Select()  in SelectionDAGISel subclass
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Select():</p> <ul><li>receive an SDNode parameter to be matched</li> <li>return SDNnode value representing a phycical instruction</li></ul> <p>Selection() will call TableGen generateed SelectCode method.<br>
TableGen also contains MatcherTable, mapping <strong>ISD and <Target>ISD</Target></strong> to <strong>physical-instruction node</strong>.<br>
This table is generated by <Target>InstrInfo.td<br>
The table are contained in &lt;build_dir&gt;/lib/Target/Sparc/SparcGenDAGISel.inc.<br></Target></p> <p>We can add other customized matching code prior to selectCode().</p> <p>CurDAG-&gt;getMachineNode() will create a node with phsycial instruction SP::SPAri
CurDAG-&gt;SelectNodeTo() will create an instruction node and changes all use of * result to point to the &quot;Opcode&quot; result.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>void SparcDAGToDAGISel::Select(SDNode *N) {
  ...
  case ISD::UDIV: {
    // sdivx / udivx handle 64-bit divides.
    if (N-&gt;getValueType(0) == MVT::i64)
      break;
    // FIXME: should use a custom expander to expose the SRA to the dag.
    SDValue DivLHS = N-&gt;getOperand(0);
    SDValue DivRHS = N-&gt;getOperand(1);

    // Set the Y register to the high-part.
    SDValue TopPart;
    if (N-&gt;getOpcode() == ISD::SDIV) {
      TopPart = SDValue(CurDAG-&gt;getMachineNode(SP::SRAri, dl, MVT::i32, DivLHS,
                                   CurDAG-&gt;getTargetConstant(31, dl, MVT::i32)),
                        0);
    } else {
      TopPart = CurDAG-&gt;getRegister(SP::G0, MVT::i32);
    }
    TopPart = CurDAG-&gt;getCopyToReg(CurDAG-&gt;getEntryNode(), dl, SP::Y, TopPart,
                                   SDValue())
                  .getValue(1);

    // FIXME: Handle div by immediate.
    unsigned Opcode = N-&gt;getOpcode() == ISD::SDIV ? SP::SDIVrr : SP::UDIVrr;
    CurDAG-&gt;SelectNodeTo(N, Opcode, MVT::i32, DivLHS, DivRHS, TopPart);
    return;
  }
  }

  SelectCode(N);
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h4 id="_8-2-visualizing-the-instruction-selection-process"><a href="#_8-2-visualizing-the-instruction-selection-process" class="header-anchor">#</a> 8.2 Visualizing the instruction selection process</h4> <table><thead><tr><th>llc</th> <th>Phase</th></tr></thead> <tbody><tr><td>-view-dag-combine1-dags</td> <td>Before DAG combine 1</td></tr> <tr><td>-view-legalize-types-dags</td> <td>Before legalize type</td></tr> <tr><td>-view-dag-combine-lt-dags</td> <td>After legalize type 2 and before DAG combine</td></tr> <tr><td>-view-legalize-dags</td> <td>Before legalization</td></tr> <tr><td>-view-dag-combine2-dags</td> <td>Before DAG combine 2</td></tr> <tr><td>-view-isel-dags</td> <td>Before instruction selection</td></tr> <tr><td>-view-sched-dags</td> <td>After instruction selection and before scheduling</td></tr></tbody></table> <h3 id="_9-scheduler"><a href="#_9-scheduler" class="header-anchor">#</a> 9. Scheduler</h3> <p>Pre-register allocation works on SelectionDAG nodes(SDNodes).<br></p> <p>&lt;llvm_source&gt;/ lib/CodeGen/SelectionDAG/ScheduleDAGSDNodes.cpp</p> <p>Different Algorithms: llc -pre-RA-sched=<scheduler></scheduler></p> <h4 id="_9-1-instruction-itineraries"><a href="#_9-1-instruction-itineraries" class="header-anchor">#</a> 9.1 Instruction Itineraries</h4> <p>&lt;llvm_source&gt;/include/llvm/Target/TargetItinerary.td <br>
&lt;llvm_source&gt;/lib/Target/ARM/ARMScheduleA8.td <br></p> <p>Represent instruction latencya and hardware pipeline information.</p> <p><img src="https://github.com/hitqshao/qishao-notes/assets/23403286/5c502b6c-9972-4fd8-b832-f2cc238e6fe4" alt="image"></p> <h4 id="_9-2-hazard-detection"><a href="#_9-2-hazard-detection" class="header-anchor">#</a> 9.2 Hazard Detection</h4> <blockquote><p>The ScheduleHazardRecognizer class provides an interface for hazard recognizer implementations and the ScoreboardHazardRecognizer subclass implements the scoreboard hazard recognizer (see the file &lt;llvm_source&gt;/lib/CodeGen/ScoreboardHazardRecognizer.cpp), which is LLVM's default recognizer.</p></blockquote> <h4 id="_9-3-scheduling-units"><a href="#_9-3-scheduling-units" class="header-anchor">#</a> 9.3 Scheduling Units</h4> <p>This scheduler runs before and after register allocation, which process both SDNode instruction and MachineInstr.</p> <h3 id="_10-machine-instructions"><a href="#_10-machine-instructions" class="header-anchor">#</a> 10. Machine Instructions</h3> <p>The InstrEmitter pass, which runs after scheduling, transforms SDNode format into MachineInstr format.<br>
MI format is sequence of instructions rather than DAG.<br></p> <p>MI contains significant meta-information about an instruction: <br></p> <ul><li>it stores used and defined registers.</li> <li>it distinguishes between register and memory operands (among other types).</li> <li>it stores the instruction type (branch, return, call, and terminator, among others)</li> <li>it stores predicates such as whether it is commutable or not, and so on.</li></ul> <p><img src="https://github.com/hitqshao/qishao-notes/assets/23403286/0f94eb3a-7222-405d-b998-ded8773f629f" alt="image"></p> <p>llc -print-machineinstrs</p> <p>llc -print-machineinstrs=<pass-name></pass-name></p> <h3 id="_11-register-allocation"><a href="#_11-register-allocation" class="header-anchor">#</a> 11. Register Allocation</h3> <ul><li>some MI code fragments might already use physical registers even before register allocation.
<ul><li>Machine instructions that nee specific register</li> <li>ABI requirement</li></ul></li> <li>Destruct SSA form of IR</li></ul> <p>4 register allocation algoritm</p> <p>-regalloc=&lt;pbqp/greedy/basic/fast&gt;</p> <p>by default, it will be basic(linear scan).</p> <p><img src="https://github.com/hitqshao/qishao-notes/assets/23403286/f29b03a3-372d-4278-9e32-36e0f028f160" alt="image"></p> <h4 id="_11-1-register-coalescer"><a href="#_11-1-register-coalescer" class="header-anchor">#</a> 11.1 Register Coalescer</h4> <p>lib/CodeGen/RegisterCoalescer.cpp<br></p> <ul><li>A machine Function Pass, joinAllIntervals will iterate a work list of copy functions.</li> <li>joinCopy creates CoalescerPair instances from copy machine instructions and coalesces copies wasy.</li></ul> <p>Before the coalescer,  the phi node elimination pass runs.<br>
llc -print-machine-insts=phi-node-elimination will show this.</p> <p>Machine Instruction will be indexed with 0B, 16B, 32B(<strong>slot indexes</strong>).</p> <p><strong>live variable analysis pass</strong> runs before coalescing, thus the code is annotated with live variable information</p> <ul><li>which points each register is defined and killed</li> <li>This is useful for ust to know which registers interfere with one other, that is are alive at the same time and need to live in distinct physical register.(Similar to graph coloring)</li></ul> <p>Coalescer will also look for register copies, try to join the interval of the source register with the interval of the destination register.<br>
The above is based on <strong>live interval analysis</strong>(different from live variable analysis).</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>llc -march=sparc -debug-only=regalloc *.bc
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_11-2-virtual-register-rewrite"><a href="#_11-2-virtual-register-rewrite" class="header-anchor">#</a> 11.2 Virtual Register Rewrite</h4> <ul><li>Register Allocation Pass will selects the physical registers to be used for each virtual one.<br></li> <li>VirtRegMap contains mapping from virt to phy register.</li> <li>VirtRegRewriter class implemented in &lt;llvm_source&gt;/lib/CodeGen/VirtRegMap.cpp—uses VirtRegMap and replaces virtual register references with physical ones.</li> <li>Spill Code is also generated.</li> <li>reg = COPY reg are deleted.</li></ul> <blockquote><p>The register allocator and the instruction scheduler are sworn enemies in any compiler.<br>
The job of the register allocator is to keep live ranges as short as possible, reducing the number of edges of the interference graph and thus reducing the number of necessary registers to avoid spills. To do this, the register allocator prefers to schedule instructions in a serial fashion (putting an instruction that depends on the other right next to it) because in this way the code uses less registers. <br>
The job of the scheduler is the opposite: to extract instruction-level parallelism, it needs to keep alive as much unrelated and parallel computations as possible, requiring a much larger number of registers to hold intermediary values and increasing the number of interferences among live ranges.</p></blockquote> <h4 id="_11-3-target-hooks"><a href="#_11-3-target-hooks" class="header-anchor">#</a> 11.3 Target Hooks</h4> <ol><li>TargetRegisterInfo includes if it is reserved or not, its parent register classes, and whether it is physical or virtual</li> <li><Target>InstrInfo
<ul><li>isLoadFromStackSlot() and isStoreToStackSlot() are used during <strong>spill code</strong> generation to discover whether the machine instruction is a memory access to a stack slot.</li> <li>Spiller use using the storeRegToStackSlot() and loadRegFromStackSlot() methods with target-specific memory access instructions.</li> <li>copyPhyReg() method will also generate target-specific register copy.</li></ul></Target></li></ol> <p>The <strong>BuildMI()</strong> method is used everywhere in the code generator to generate machine instructions.</p> <h3 id="_12-prologue-and-epilogue"><a href="#_12-prologue-and-epilogue" class="header-anchor">#</a> 12. Prologue and epilogue</h3> <ol><li>Prologue sets up the stack frame and callee-saved registers during the beginning of a function.</li> <li>Epilogue cleans up the stack frame prior to function return.
They are target-specific, defined in <Target>FrameLowering::emitPrologue() and <Target>FrameLowering::emitEpilogue() at &lt;llvm_source&gt;/lib/Target/<Target>/<Target>FrameLowering.cpp)</Target></Target></Target></Target></li></ol> <h3 id="_13-frame-indexs"><a href="#_13-frame-indexs" class="header-anchor">#</a> 13. Frame indexs</h3> <p>&lt;llvm_source&gt;/lib/Target/<Target>/<Target>RegisterInfo.cpp contains eliminateFrameIndex().<br>
It will replace each frame index to real stack offset for all machine instructions that contain stack reference.</Target></Target></p> <h3 id="_13-understanding-machine-code-framework"><a href="#_13-understanding-machine-code-framework" class="header-anchor">#</a> 13. Understanding machine code framework</h3> <p>convert machine instruction into machine code instructions(MC instructions).
<img src="https://github.com/hitqshao/qishao-notes/assets/23403286/6a160bf3-a235-4518-9da0-1f7acd44e518" alt="image"></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// show MC inst
llc *.bc -march=x86-64 -show-mc-inst -o -

// show assemble encoding
echo &quot;movq 48879(,%riz), %rax&quot; | llvm-mc -triple=x86_64 --show-encoding
 # encoding: [0x48,0x8b,0x04,0x25,0xef,0xbe,0x00,0x00]

// disassemble
echo &quot;0x8d 0x4c 0x24 0x04&quot; | llvm-mc --disassemble -triple=x86_64
 leal 4(%rsp), %ecx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="summary"><a href="#summary" class="header-anchor">#</a> Summary</h3> <blockquote><p>https://jonathan2251.github.io/lbd/_images/9.png
<img src="https://github.com/hitqshao/qishao-notes/assets/23403286/fc9da0b9-7ea7-435d-9bab-c7b37b1438a1" alt="image"></p></blockquote></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/hitqshao/qishao-notes/edit/main/docs/02.compiler/03.GetStartedLLVMChap6Notes.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2024/08/13, 16:55:27</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/qishao-notes/pages/000002/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Getting Started with LLVM Core Libraries-Notes Chap5 IR</div></a> <a href="/qishao-notes/pages/000004/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Learning LLVM Diary 00</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/qishao-notes/pages/000002/" class="prev">Getting Started with LLVM Core Libraries-Notes Chap5 IR</a></span> <span class="next"><a href="/qishao-notes/pages/000004/">Learning LLVM Diary 00</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="https://github.com/hitqshao" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="mailto:hitqshao@163.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://gitee.com/hitqshao" title="Gitee" target="_blank" class="iconfont icon-gitee"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2024
    <span>Eryajf | <a href="https://github.com/hitqshao/qishao-notes/blob/main/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><!----></div></div>
    <script src="/qishao-notes/assets/js/app.060b0fa6.js" defer></script><script src="/qishao-notes/assets/js/2.75973713.js" defer></script><script src="/qishao-notes/assets/js/24.ae95a93e.js" defer></script>
  </body>
</html>
