<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>GPU Cache Coherency | CPU &amp; GPU Microarch. Qi Shao</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="stylesheet" href="custom.css">
    <script language="javascript" type="text/javascript" src="/qishao-notes/js/pgmanor-self.js"></script>
    <meta name="description" content="Computer System">
    <meta name="google-site-verification" content="66w5U9NY5gJWu7iBtHKMbhpXkV94jy31L_RHbvrZZzY">
    <meta name="keywords" content="Hitqishao,golang,vue,go-web,go-admin,go-ldap-admin">
    <meta name="theme-color" content="#11a8cd">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <link rel="preload" href="/qishao-notes/assets/css/0.styles.922e50b3.css" as="style"><link rel="preload" href="/qishao-notes/assets/js/app.0b93ea74.js" as="script"><link rel="preload" href="/qishao-notes/assets/js/2.75973713.js" as="script"><link rel="preload" href="/qishao-notes/assets/js/48.b127f827.js" as="script"><link rel="prefetch" href="/qishao-notes/assets/js/10.ff60f5f4.js"><link rel="prefetch" href="/qishao-notes/assets/js/11.35356818.js"><link rel="prefetch" href="/qishao-notes/assets/js/12.668e833a.js"><link rel="prefetch" href="/qishao-notes/assets/js/13.96e9fb44.js"><link rel="prefetch" href="/qishao-notes/assets/js/14.a3fe5ba3.js"><link rel="prefetch" href="/qishao-notes/assets/js/15.74839805.js"><link rel="prefetch" href="/qishao-notes/assets/js/16.273c8e9e.js"><link rel="prefetch" href="/qishao-notes/assets/js/17.be625961.js"><link rel="prefetch" href="/qishao-notes/assets/js/18.7ae41e76.js"><link rel="prefetch" href="/qishao-notes/assets/js/19.6f5bbf6a.js"><link rel="prefetch" href="/qishao-notes/assets/js/20.fb3029b6.js"><link rel="prefetch" href="/qishao-notes/assets/js/21.c94fe2f0.js"><link rel="prefetch" href="/qishao-notes/assets/js/22.c1607cf8.js"><link rel="prefetch" href="/qishao-notes/assets/js/23.cb104322.js"><link rel="prefetch" href="/qishao-notes/assets/js/24.ae95a93e.js"><link rel="prefetch" href="/qishao-notes/assets/js/25.017bb7ac.js"><link rel="prefetch" href="/qishao-notes/assets/js/26.9a920fc3.js"><link rel="prefetch" href="/qishao-notes/assets/js/27.e8d36ebd.js"><link rel="prefetch" href="/qishao-notes/assets/js/28.e3478362.js"><link rel="prefetch" href="/qishao-notes/assets/js/29.761f6df6.js"><link rel="prefetch" href="/qishao-notes/assets/js/3.4a0dc4e2.js"><link rel="prefetch" href="/qishao-notes/assets/js/30.7ebc6539.js"><link rel="prefetch" href="/qishao-notes/assets/js/31.cf0fcf7c.js"><link rel="prefetch" href="/qishao-notes/assets/js/32.d525b9e3.js"><link rel="prefetch" href="/qishao-notes/assets/js/33.d5bcbc9c.js"><link rel="prefetch" href="/qishao-notes/assets/js/34.f0379461.js"><link rel="prefetch" href="/qishao-notes/assets/js/35.92874369.js"><link rel="prefetch" href="/qishao-notes/assets/js/36.53fa01a5.js"><link rel="prefetch" href="/qishao-notes/assets/js/37.c757368f.js"><link rel="prefetch" href="/qishao-notes/assets/js/38.dfb7124c.js"><link rel="prefetch" href="/qishao-notes/assets/js/39.d672ebba.js"><link rel="prefetch" href="/qishao-notes/assets/js/4.424759af.js"><link rel="prefetch" href="/qishao-notes/assets/js/40.649dd40b.js"><link rel="prefetch" href="/qishao-notes/assets/js/41.a7a605ab.js"><link rel="prefetch" href="/qishao-notes/assets/js/42.add63d64.js"><link rel="prefetch" href="/qishao-notes/assets/js/43.7b76fbd7.js"><link rel="prefetch" href="/qishao-notes/assets/js/44.4289179a.js"><link rel="prefetch" href="/qishao-notes/assets/js/45.e4f4449f.js"><link rel="prefetch" href="/qishao-notes/assets/js/46.3e07a754.js"><link rel="prefetch" href="/qishao-notes/assets/js/47.a81db25f.js"><link rel="prefetch" href="/qishao-notes/assets/js/49.9fc0153b.js"><link rel="prefetch" href="/qishao-notes/assets/js/5.d619f2db.js"><link rel="prefetch" href="/qishao-notes/assets/js/50.fcc7611c.js"><link rel="prefetch" href="/qishao-notes/assets/js/51.9db4eae7.js"><link rel="prefetch" href="/qishao-notes/assets/js/52.907dcc8f.js"><link rel="prefetch" href="/qishao-notes/assets/js/53.ab17a194.js"><link rel="prefetch" href="/qishao-notes/assets/js/54.8736e2b3.js"><link rel="prefetch" href="/qishao-notes/assets/js/55.6844fc6b.js"><link rel="prefetch" href="/qishao-notes/assets/js/56.229696df.js"><link rel="prefetch" href="/qishao-notes/assets/js/57.b4b0a8ff.js"><link rel="prefetch" href="/qishao-notes/assets/js/58.4cbb9510.js"><link rel="prefetch" href="/qishao-notes/assets/js/59.54c83179.js"><link rel="prefetch" href="/qishao-notes/assets/js/6.c982ad78.js"><link rel="prefetch" href="/qishao-notes/assets/js/60.1033eac8.js"><link rel="prefetch" href="/qishao-notes/assets/js/61.681657ee.js"><link rel="prefetch" href="/qishao-notes/assets/js/62.9e97e603.js"><link rel="prefetch" href="/qishao-notes/assets/js/63.7895da37.js"><link rel="prefetch" href="/qishao-notes/assets/js/64.bd9fce37.js"><link rel="prefetch" href="/qishao-notes/assets/js/65.ab150561.js"><link rel="prefetch" href="/qishao-notes/assets/js/66.468145b1.js"><link rel="prefetch" href="/qishao-notes/assets/js/67.fec1bfc3.js"><link rel="prefetch" href="/qishao-notes/assets/js/68.a5140b99.js"><link rel="prefetch" href="/qishao-notes/assets/js/69.1efc41ea.js"><link rel="prefetch" href="/qishao-notes/assets/js/7.8a29f90e.js"><link rel="prefetch" href="/qishao-notes/assets/js/70.57db6db5.js"><link rel="prefetch" href="/qishao-notes/assets/js/71.0757da7d.js"><link rel="prefetch" href="/qishao-notes/assets/js/72.a46b2f32.js"><link rel="prefetch" href="/qishao-notes/assets/js/73.93190960.js"><link rel="prefetch" href="/qishao-notes/assets/js/74.e7e1a8db.js"><link rel="prefetch" href="/qishao-notes/assets/js/75.6880a5e4.js"><link rel="prefetch" href="/qishao-notes/assets/js/76.5b27e2ac.js"><link rel="prefetch" href="/qishao-notes/assets/js/77.ad4277d1.js"><link rel="prefetch" href="/qishao-notes/assets/js/78.93757fc1.js"><link rel="prefetch" href="/qishao-notes/assets/js/79.e53d761c.js"><link rel="prefetch" href="/qishao-notes/assets/js/8.316deedd.js"><link rel="prefetch" href="/qishao-notes/assets/js/80.e4ceb363.js"><link rel="prefetch" href="/qishao-notes/assets/js/9.3863430d.js">
    <link rel="stylesheet" href="/qishao-notes/assets/css/0.styles.922e50b3.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="ÁõÆÂΩï" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/qishao-notes/" class="home-link router-link-active"><!----> <span class="site-name">CPU &amp; GPU Microarch. Qi Shao</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/qishao-notes/" class="nav-link">Home</a></div><div class="nav-item"><a href="/qishao-notes/gpu/" class="nav-link">gpu</a></div><div class="nav-item"><a href="/qishao-notes/cpu/" class="nav-link">cpu</a></div><div class="nav-item"><a href="/qishao-notes/llm/" class="nav-link">ml&amp;llm</a></div><div class="nav-item"><a href="/qishao-notes/compiler/" class="nav-link">compiler</a></div><div class="nav-item"><a href="/qishao-notes/hbm/" class="nav-link">hbm</a></div><div class="nav-item"><a href="/qishao-notes/unix/" class="nav-link">unix</a></div><div class="nav-item"><a href="https://blog.csdn.net/hit_shaoqi" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/hitqshao/qishao-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/qishao-notes/" class="nav-link">Home</a></div><div class="nav-item"><a href="/qishao-notes/gpu/" class="nav-link">gpu</a></div><div class="nav-item"><a href="/qishao-notes/cpu/" class="nav-link">cpu</a></div><div class="nav-item"><a href="/qishao-notes/llm/" class="nav-link">ml&amp;llm</a></div><div class="nav-item"><a href="/qishao-notes/compiler/" class="nav-link">compiler</a></div><div class="nav-item"><a href="/qishao-notes/hbm/" class="nav-link">hbm</a></div><div class="nav-item"><a href="/qishao-notes/unix/" class="nav-link">unix</a></div><div class="nav-item"><a href="https://blog.csdn.net/hit_shaoqi" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/hitqshao/qishao-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/qishao-notes/pages/cc7034/" class="sidebar-link">Operand Collector</a></li><li><a href="/qishao-notes/pages/2476ae/" class="sidebar-link">GPU WARP Scheduler</a></li><li><a href="/qishao-notes/pages/14769f/" class="sidebar-link">Precision Exception</a></li><li><a href="/qishao-notes/pages/44771e/" class="sidebar-link">Unified Memory Paper List</a></li><li><a href="/qishao-notes/pages/44871e/" class="sidebar-link">TensorCore Paper List</a></li><li><a href="/qishao-notes/pages/45871e/" class="sidebar-link">Memory Behaviour Paper List</a></li><li><a href="/qishao-notes/pages/45871f/" class="sidebar-link">GPU Virtualization Paper List</a></li><li><a href="/qishao-notes/pages/458720/" class="sidebar-link">Large Language Model Paper List</a></li><li><a href="/qishao-notes/pages/458721/" class="sidebar-link">GPU Simulator</a></li><li><a href="/qishao-notes/pages/458722/" class="sidebar-link">Architectural Survey</a></li><li><a href="/qishao-notes/pages/458724/" class="sidebar-link">Harnessing Integrated CPU-GPU System Memory for HPC a first look into Grace Hopper</a></li><li><a href="/qishao-notes/pages/458725/" class="sidebar-link">Understanding GPGPU-SIM 1 How to get Instruction</a></li><li><a href="/qishao-notes/pages/458726/" class="sidebar-link">Understanding GPGPU-SIM 2 Instruction Execution</a></li><li><a href="/qishao-notes/pages/458727/" class="sidebar-link">Understanding GPGPU-SIM 3 How is the simulation started</a></li><li><a href="/qishao-notes/pages/45872/" class="sidebar-link">Understanding GPGPU-SIM 4 Microarchitecture</a></li><li><a href="/qishao-notes/pages/45874/" class="sidebar-link">Understanding GPGPU-SIM 5  Memory Interface</a></li><li><a href="/qishao-notes/pages/45873/" class="sidebar-link">Warp Related Memory Optimization</a></li><li><a href="/qishao-notes/pages/45875/" aria-current="page" class="active sidebar-link">GPU Cache Coherency</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/qishao-notes/pages/45876/" class="sidebar-link">GPU Cache &amp; Memory Hirerarchy</a></li><li><a href="/qishao-notes/pages/45877/" class="sidebar-link">GPU TLB</a></li><li><a href="/qishao-notes/pages/45878/" class="sidebar-link">GPU Page Table Walk</a></li><li><a href="/qishao-notes/pages/45879/" class="sidebar-link">GPU Cache's Papers</a></li><li><a href="/qishao-notes/pages/45880/" class="sidebar-link">GPU WARP Mangement Papers</a></li><li><a href="/qishao-notes/pages/45882/" class="sidebar-link">GPU Unified Memory Innovations</a></li><li><a href="/qishao-notes/pages/45883/" class="sidebar-link">GPU MultiTask</a></li><li><a href="/qishao-notes/pages/45884/" class="sidebar-link">GPU Training Notes</a></li><li><a href="/qishao-notes/pages/45885/" class="sidebar-link">GPU Paper with Code</a></li><li><a href="/qishao-notes/pages/45886/" class="sidebar-link">GPU Workload Characteristics</a></li><li><a href="/qishao-notes/pages/47871e/" class="sidebar-link">TO READ</a></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/qishao-notes/" title="È¶ñÈ°µ" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/qishao-notes/gpu/#gpu" data-v-06225672>gpu</a></li></ul> <div class="info" data-v-06225672><div title="‰ΩúËÄÖ" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/hitqshao" target="_blank" title="‰ΩúËÄÖ" class="beLink" data-v-06225672>hitqishao</a></div> <div title="ÂàõÂª∫Êó∂Èó¥" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2024-08-21</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">ÁõÆÂΩï</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">GPU Cache Coherency<!----></h1> <!----> <div class="theme-vdoing-content content__default"><ol><li>[213] Cache Coherence for GPU Architectures</li></ol> <hr> <h3 id="_1-213-cache-coherence-for-gpu-architectures"><a href="#_1-213-cache-coherence-for-gpu-architectures" class="header-anchor">#</a> 1. [213] Cache Coherence for GPU Architectures</h3> <h4 id="another-design-in-cpu-llc"><a href="#another-design-in-cpu-llc" class="header-anchor">#</a> Another Design in CPU LLC</h4> <p>Library Cache Coherence (LCC), that implements sequential consistency on CMPs by stalling writes to cache blocks until they have been self-invalidated by all sharers.</p> <p>Library Cache Coherence (LCC) [34, 54] is a time-based hardware coherence proposal that stores timestamps in a directory structure and delays stores to unexpired blocks to enforce sequential consistency on CMPs.<br>
The TC-Strong implementation of the TC framework is similar to LCC as both enforce write atomicity by stalling writes at the shared last level cache.</p> <p><img src="https://github.com/user-attachments/assets/3e7e13cc-7d64-4234-897b-03754489dd1f" alt="image"></p> <h4 id="background"><a href="#background" class="header-anchor">#</a> Background</h4> <p><img src="https://github.com/user-attachments/assets/2e62c5ed-574b-4cc2-9f85-8b269dc80358" alt="image"></p> <p>We propose TC-Weak and a novel time-based memory fence mechanism to eliminate all write-stalling, improve performance, and reduce interconnect traffic compared to TC-Strong.</p> <ul><li>We find that the stalling of writes in TC-Strong causes poor performance on a GPU.</li> <li>We also show that unlike for CPU applications [34, 54], the fixed timestamp prediction proposed by LCC is not suited for GPU applications.</li></ul> <h4 id="gpu-memory-system"><a href="#gpu-memory-system" class="header-anchor">#</a> GPU Memory System</h4> <p>Both thread-private and global memory are stored in off-chip GDDR DRAM and cached in the multi-level cache hierarchy, however only <strong>global memory requires coherence</strong>.</p> <p>Memory accesses to the same cache block from different threads within a wavefront are merged into a single wide access by the Coalescing Unit.<br>
A memory instruction generates one memory access for every unique cache line accessed by the wavefront.<br>
All requests are handled in FIFO order by the in-order memory stage of a GPU core.<br>
üôá <strong>Writes to the same word by multiple scalar threads in a single wavefront do not have a defined behaviour [46]; only one write will succeed</strong>.</p> <h4 id="gpu-cache-hierarchy"><a href="#gpu-cache-hierarchy" class="header-anchor">#</a> GPU Cache Hierarchy</h4> <p>The GPU cache hierarchy consists of per-core private L1 data caches and a shared L2 cache.<br>
The L1 caches are not coherent.<br>
They follow a write-evict [46] (write-purge [24]), write no-allocate caching policy. <br>
The L2 caches are writeback with write-allocate.</p> <p>Memory accesses generated by the coalescing unit in each GPU core are passed, one per cycle, to the per-core MSHR table. <br>
The MSHR table combines read accesses to the same cache line from different wavefronts to ensure <strong>only a single read access per-cache line per-GPU core</strong> is outstanding.</p> <p><strong>Writes are not combined and, since they write-through, any number of write requests to the same cache line from a GPU core may be outstanding.</strong></p> <p><strong>Point-to-point ordering in the interconnection network, L2 cache controllers and off-chip DRAM channels ensures that multiple outstanding writes from the same wavefront to the same
address complete in program order.</strong></p> <p>This is another situation different from üôá. It is different code in a program that write to the same address.</p> <h4 id="atomic-operation"><a href="#atomic-operation" class="header-anchor">#</a> Atomic Operation</h4> <p>Atomic Operation. Read-modify-write atomic operations are performed at each memory partition by an Atomic Operation Unit.</p> <h4 id="consistency-and-coherence"><a href="#consistency-and-coherence" class="header-anchor">#</a> Consistency and Coherence</h4> <p>A cache coherence protocol performs the following three duties [3].</p> <ul><li>It propagates newly written values to all privately cached copies.</li> <li>It informs the writing thread or processor when a write has been completed and is visible to all threads and processors.</li> <li>Lastly, a coherence protocol may ensure write atomicity [3], i.e., a value from a write is logically seen by all threads at once.</li></ul> <p>Write atomicity is commonly enforced in write-invalidate coherence protocols by requiring that all other copies of a cache block are invalidated before a write is completed.</p> <p><strong>Memory consistency models may [4, 19, 57, 59] or may not [2, 19, 53] require write atomicity.</strong></p> <h4 id="directory-protocols"><a href="#directory-protocols" class="header-anchor">#</a> Directory Protocols</h4> <h5 id="mesi"><a href="#mesi" class="header-anchor">#</a> MESI</h5> <p><strong>four-state coherence protocol with writeback L1 and L2 caches</strong>
The write-allocate policy at L1 requires that write data be buffered until proper coherence permission has been obtained.<br>
This requires the addition of area and complexity to buffer stores in each GPU core.</p> <h5 id="gpu-vi"><a href="#gpu-vi" class="header-anchor">#</a> GPU-VI</h5> <p><strong>two-state coherence protocol</strong>
GPU-VI implements write-through, no write-allocate L1 caches.<br>
It requires that any write completing at the L2 invalidate all L1 copies.<br>
A write to a shared cache line cannot complete until the L2 controller has sent invalidation requests and received acknowledgments from all sharers.</p> <p>Two Optimizations:</p> <ul><li>First, it writes data directly to the L1 cache on a write hit before receiving an acknowledgement, eliminating the area and complexity overheads of buffering stores.</li> <li>Second, it treats loads to L1 blocks with pending writes as <strong>misses</strong>. This reduces stalling at the cache controller while maintaining write atomicity.</li></ul> <h4 id="challenges"><a href="#challenges" class="header-anchor">#</a> Challenges</h4> <h5 id="coherence-traffic"><a href="#coherence-traffic" class="header-anchor">#</a> Coherence Traffic</h5> <p>These overheads consist of recall traffic due to:</p> <ul><li>directory evictions,</li> <li>false sharing invalidation traffic,</li> <li>invalidation traffic due to inter-kernel communication.</li></ul> <p>An effective way to reduce coherence traffic is to selectively disable coherence for data regions that do not require it.</p> <h5 id="storage-requirements"><a href="#storage-requirements" class="header-anchor">#</a> Storage Requirements</h5> <p>In a CPU-like coherence implementation [18] with enough storage to handle the worst  case number of memory accesses (one memory request per thread), a directory protocol would require an impractical on-chip buffer as large as 28% of the total GPU L2 cache for tracking coherence requests.</p> <h5 id="protocal-complexity"><a href="#protocal-complexity" class="header-anchor">#</a> Protocal Complexity</h5> <p>stable states &amp; Transient coherent states</p> <h4 id="temporal-coherence"><a href="#temporal-coherence" class="header-anchor">#</a> Temporal Coherence</h4> <p><img src="https://github.com/user-attachments/assets/28162506-3247-4bcd-85ab-2519a647d507" alt="image"></p> <p><img src="https://github.com/user-attachments/assets/246495be-7699-4612-936f-cc099582ef21" alt="image"></p> <h4 id="tc-strong-coherence"><a href="#tc-strong-coherence" class="header-anchor">#</a> TC-strong Coherence</h4> <p><img src="https://github.com/user-attachments/assets/16938b69-2d03-4867-b8c2-1e6ba8e3a4e7" alt="image"></p> <h4 id="tc-weak-coherence"><a href="#tc-weak-coherence" class="header-anchor">#</a> TC-weak Coherence</h4> <p>TC-Weak relaxes the write atomicity of TC-Strong. As we show in Section 8.3, doing so improves performance by 28% and lowers interconnect traffic by 26% compared to TC-Strong.</p> <p>TC-Strong and LCC enforce coherence across all data by stalling writes.<br>
TC-Weak uses the insight that <strong>GPU applications may contain large amounts of data which does not require coherence and is unnecessarily penalized by write-stalling</strong>.<br>
By relaxing write-atomicity, TC-Weak eliminates write-stalling and shifts any potential stalling to explicit memory fence operations.</p> <p>Major two benefitsÔºö</p> <ul><li>First, it eliminates expensive stalling at the shared L2 cache controllers, which affects all cores and wavefronts, and shifts it to scheduling of individual wavefronts at memory fences.<br>
A wavefront descheduled due to a memory fence does not affect the performance of other wavefronts.</li> <li>Second, it enforces coherence only when required and specified by the program through memory fences. It implements the RCpc [19] consistency model; a detailed discussion on
this is available elsewhere [56].</li></ul> <p><img src="https://github.com/user-attachments/assets/9c775df1-72e3-40bd-a476-4f2e8670fcc1" alt="image"></p> <h5 id="tc-strong"><a href="#tc-strong" class="header-anchor">#</a> TC Strong:</h5> <p>F1 defers scheduling the wavefront because the wavefront has an outstanding store request.<br>
When S1‚Äôs store request reaches the L2 ( 3 ), the L2 stalls it because data‚Äôs global timestamp will not expire until time T=30.<br>
At T=30, C2 self-invalidates data ( 4 ), and the L2 processes S1‚Äôs store ( 5 ).<br>
The fence instruction completes when C1 receives the acknowledgment for S1‚Äôs request ( 6 ).</p> <h5 id="tc-weak"><a href="#tc-weak" class="header-anchor">#</a> TC Weak:</h5> <p>The write response returns with the  global timestamp of the L2 cache line at the time of the write. The returned global timestamp is the guaranteed time by which the write will become visible to all cores in the system.<br>
This is because by this time all cores will have invalidated their privately cached stale copies.</p> <p>In this case, the value returned is 30 and corresponds to C2‚Äôs initially cached copy.<br>
The L2 does not stall the write and sends back an acknowledgment with the GWCT, which updates the C1‚Äôs GWCT entry for this wavefront.<br>
After C1 receives the acknowledgment ( 4‚Äô ), no memory requests are outstanding.</p> <p>Comparing Figure 6(c) to 6(b) shows that TC-Weak performs better than TC-Strong because <strong>it only stalls at explicit memory fence operations</strong>.<br>
This ensures that writes to data that does not require coherence has minimal impact.</p> <p>TC-Weak tracks the global timestamps returned by writes, called Global Write Completion Times (GWCT), for each wave-front.<br>
A memory fence operation uses this information to deschedule the wavefront sufficiently long enough to guar=antee that all previous writes from the wavefront have become globally visible.</p> <h4 id="lifetime-prediction"><a href="#lifetime-prediction" class="header-anchor">#</a> Lifetime Prediction</h4> <ul><li>we show that a single lifetime value for all accesses performs well.</li> <li>Moreover, this value is application dependent.</li></ul> <p>a single lifetime prediction value at each L2 cache bank, and adjusts it based on application behaviour. A load obtains its lifetime prediction at the L2 bank.</p> <p>The lifetime estimation is based on events local to L2 bank</p> <ul><li>L2 Block with unexpired timestamp evicted</li> <li>load request miss in L1 due to expired</li> <li>L2 receive a load request to a valid block with an expired global timestamp</li> <li>store operation writes to an unexpired block at L2</li></ul></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/hitqshao/qishao-notes/edit/main/docs/03.gpu/18.gpucoherency.md" target="_blank" rel="noopener noreferrer">Â∏ÆÂä©Êàë‰ª¨ÊîπÂñÑÊ≠§È°µÈù¢</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">‰∏äÊ¨°Êõ¥Êñ∞:</span> <span class="time">2024/10/31, 00:50:54</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/qishao-notes/pages/45873/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Warp Related Memory Optimization</div></a> <a href="/qishao-notes/pages/45876/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">GPU Cache &amp; Memory Hirerarchy</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ‚Üê
        <a href="/qishao-notes/pages/45873/" class="prev">Warp Related Memory Optimization</a></span> <span class="next"><a href="/qishao-notes/pages/45876/">GPU Cache &amp; Memory Hirerarchy</a>‚Üí
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="https://github.com/hitqshao" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="mailto:hitqshao@163.com" title="ÂèëÈÇÆ‰ª∂" target="_blank" class="iconfont icon-youjian"></a><a href="https://gitee.com/hitqshao" title="Gitee" target="_blank" class="iconfont icon-gitee"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="Êú¨Á´ô‰∏ªÈ¢ò">Vdoing</a> 
    | Copyright ¬© 2022-2024
    <span>Eryajf | <a href="https://github.com/hitqshao/qishao-notes/blob/main/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="ËøîÂõûÈ°∂ÈÉ®" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="ÂéªËØÑËÆ∫" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="‰∏ªÈ¢òÊ®°Âºè" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          Ë∑üÈöèÁ≥ªÁªü
        </li><li class="iconfont icon-rijianmoshi">
          ÊµÖËâ≤Ê®°Âºè
        </li><li class="iconfont icon-yejianmoshi">
          Ê∑±Ëâ≤Ê®°Âºè
        </li><li class="iconfont icon-yuedu">
          ÈòÖËØªÊ®°Âºè
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><!----></div></div>
    <script src="/qishao-notes/assets/js/app.0b93ea74.js" defer></script><script src="/qishao-notes/assets/js/2.75973713.js" defer></script><script src="/qishao-notes/assets/js/48.b127f827.js" defer></script>
  </body>
</html>
