<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>LLM Attention | CPU &amp; GPU Microarch. Qi Shao</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="stylesheet" href="custom.css">
    <script language="javascript" type="text/javascript" src="/qishao-notes/js/pgmanor-self.js"></script>
    <meta name="description" content="Computer System">
    <meta name="google-site-verification" content="66w5U9NY5gJWu7iBtHKMbhpXkV94jy31L_RHbvrZZzY">
    <meta name="keywords" content="Hitqishao,golang,vue,go-web,go-admin,go-ldap-admin">
    <meta name="theme-color" content="#11a8cd">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <link rel="preload" href="/qishao-notes/assets/css/0.styles.b5ad55b3.css" as="style"><link rel="preload" href="/qishao-notes/assets/js/app.22de7e07.js" as="script"><link rel="preload" href="/qishao-notes/assets/js/2.0833fe67.js" as="script"><link rel="preload" href="/qishao-notes/assets/js/105.bf5d1820.js" as="script"><link rel="prefetch" href="/qishao-notes/assets/js/10.1e500a78.js"><link rel="prefetch" href="/qishao-notes/assets/js/100.ded8f64a.js"><link rel="prefetch" href="/qishao-notes/assets/js/101.38fab0b5.js"><link rel="prefetch" href="/qishao-notes/assets/js/102.6e5c8073.js"><link rel="prefetch" href="/qishao-notes/assets/js/103.21465a2e.js"><link rel="prefetch" href="/qishao-notes/assets/js/104.9a111057.js"><link rel="prefetch" href="/qishao-notes/assets/js/106.246397c4.js"><link rel="prefetch" href="/qishao-notes/assets/js/107.18a830f3.js"><link rel="prefetch" href="/qishao-notes/assets/js/108.565e0a10.js"><link rel="prefetch" href="/qishao-notes/assets/js/109.ce9aed40.js"><link rel="prefetch" href="/qishao-notes/assets/js/11.3f1d4856.js"><link rel="prefetch" href="/qishao-notes/assets/js/110.20d7a44a.js"><link rel="prefetch" href="/qishao-notes/assets/js/111.1cbd39c1.js"><link rel="prefetch" href="/qishao-notes/assets/js/112.d7d903f3.js"><link rel="prefetch" href="/qishao-notes/assets/js/113.99871264.js"><link rel="prefetch" href="/qishao-notes/assets/js/114.ee3b1806.js"><link rel="prefetch" href="/qishao-notes/assets/js/115.b4b642c0.js"><link rel="prefetch" href="/qishao-notes/assets/js/116.8b047303.js"><link rel="prefetch" href="/qishao-notes/assets/js/117.0732b77b.js"><link rel="prefetch" href="/qishao-notes/assets/js/118.6f6e1e9d.js"><link rel="prefetch" href="/qishao-notes/assets/js/119.438b20b9.js"><link rel="prefetch" href="/qishao-notes/assets/js/12.cc100129.js"><link rel="prefetch" href="/qishao-notes/assets/js/120.697e2681.js"><link rel="prefetch" href="/qishao-notes/assets/js/121.1dd95496.js"><link rel="prefetch" href="/qishao-notes/assets/js/122.fe368739.js"><link rel="prefetch" href="/qishao-notes/assets/js/123.982df104.js"><link rel="prefetch" href="/qishao-notes/assets/js/124.82183b13.js"><link rel="prefetch" href="/qishao-notes/assets/js/125.13ea33d5.js"><link rel="prefetch" href="/qishao-notes/assets/js/126.99d29b76.js"><link rel="prefetch" href="/qishao-notes/assets/js/127.8e29e98b.js"><link rel="prefetch" href="/qishao-notes/assets/js/128.81d25b22.js"><link rel="prefetch" href="/qishao-notes/assets/js/129.cfdff60a.js"><link rel="prefetch" href="/qishao-notes/assets/js/13.7de2e04b.js"><link rel="prefetch" href="/qishao-notes/assets/js/130.ec90d300.js"><link rel="prefetch" href="/qishao-notes/assets/js/131.c98d8e38.js"><link rel="prefetch" href="/qishao-notes/assets/js/132.d7f560f5.js"><link rel="prefetch" href="/qishao-notes/assets/js/133.7fa4a7ba.js"><link rel="prefetch" href="/qishao-notes/assets/js/134.081f532a.js"><link rel="prefetch" href="/qishao-notes/assets/js/135.21a867b9.js"><link rel="prefetch" href="/qishao-notes/assets/js/136.3a23c34c.js"><link rel="prefetch" href="/qishao-notes/assets/js/14.466ec3ac.js"><link rel="prefetch" href="/qishao-notes/assets/js/15.ed64c7fa.js"><link rel="prefetch" href="/qishao-notes/assets/js/16.05da202f.js"><link rel="prefetch" href="/qishao-notes/assets/js/17.345670d7.js"><link rel="prefetch" href="/qishao-notes/assets/js/18.3f69064e.js"><link rel="prefetch" href="/qishao-notes/assets/js/19.a2c2ac4d.js"><link rel="prefetch" href="/qishao-notes/assets/js/20.61609b8a.js"><link rel="prefetch" href="/qishao-notes/assets/js/21.e5256cec.js"><link rel="prefetch" href="/qishao-notes/assets/js/22.b2f9c634.js"><link rel="prefetch" href="/qishao-notes/assets/js/23.4d4cd4e1.js"><link rel="prefetch" href="/qishao-notes/assets/js/24.88ca611d.js"><link rel="prefetch" href="/qishao-notes/assets/js/25.54245a6c.js"><link rel="prefetch" href="/qishao-notes/assets/js/26.66ba4d8f.js"><link rel="prefetch" href="/qishao-notes/assets/js/27.6685b454.js"><link rel="prefetch" href="/qishao-notes/assets/js/28.c9887203.js"><link rel="prefetch" href="/qishao-notes/assets/js/29.38e8dfbd.js"><link rel="prefetch" href="/qishao-notes/assets/js/3.3680fecc.js"><link rel="prefetch" href="/qishao-notes/assets/js/30.93526d40.js"><link rel="prefetch" href="/qishao-notes/assets/js/31.aa6fd9d8.js"><link rel="prefetch" href="/qishao-notes/assets/js/32.96306ad4.js"><link rel="prefetch" href="/qishao-notes/assets/js/33.7f37f31a.js"><link rel="prefetch" href="/qishao-notes/assets/js/34.54012013.js"><link rel="prefetch" href="/qishao-notes/assets/js/35.01d6cf82.js"><link rel="prefetch" href="/qishao-notes/assets/js/36.c355ce28.js"><link rel="prefetch" href="/qishao-notes/assets/js/37.6cb48c78.js"><link rel="prefetch" href="/qishao-notes/assets/js/38.9f9585d9.js"><link rel="prefetch" href="/qishao-notes/assets/js/39.7f09c090.js"><link rel="prefetch" href="/qishao-notes/assets/js/4.2dcb8de5.js"><link rel="prefetch" href="/qishao-notes/assets/js/40.5f352ae8.js"><link rel="prefetch" href="/qishao-notes/assets/js/41.bcc7509d.js"><link rel="prefetch" href="/qishao-notes/assets/js/42.36f25851.js"><link rel="prefetch" href="/qishao-notes/assets/js/43.9a39b8df.js"><link rel="prefetch" href="/qishao-notes/assets/js/44.ad822e3a.js"><link rel="prefetch" href="/qishao-notes/assets/js/45.acbac3e6.js"><link rel="prefetch" href="/qishao-notes/assets/js/46.86177f5e.js"><link rel="prefetch" href="/qishao-notes/assets/js/47.3c3f4c37.js"><link rel="prefetch" href="/qishao-notes/assets/js/48.74d6845e.js"><link rel="prefetch" href="/qishao-notes/assets/js/49.c2547090.js"><link rel="prefetch" href="/qishao-notes/assets/js/5.9d58ea7e.js"><link rel="prefetch" href="/qishao-notes/assets/js/50.4a3eef72.js"><link rel="prefetch" href="/qishao-notes/assets/js/51.a1fb9aec.js"><link rel="prefetch" href="/qishao-notes/assets/js/52.a8217417.js"><link rel="prefetch" href="/qishao-notes/assets/js/53.00cfb273.js"><link rel="prefetch" href="/qishao-notes/assets/js/54.92826847.js"><link rel="prefetch" href="/qishao-notes/assets/js/55.545b33b8.js"><link rel="prefetch" href="/qishao-notes/assets/js/56.5055422e.js"><link rel="prefetch" href="/qishao-notes/assets/js/57.89586274.js"><link rel="prefetch" href="/qishao-notes/assets/js/58.a1fbdc11.js"><link rel="prefetch" href="/qishao-notes/assets/js/59.5a90503c.js"><link rel="prefetch" href="/qishao-notes/assets/js/6.e3d0834d.js"><link rel="prefetch" href="/qishao-notes/assets/js/60.257e363f.js"><link rel="prefetch" href="/qishao-notes/assets/js/61.d2bb5053.js"><link rel="prefetch" href="/qishao-notes/assets/js/62.f1be6ae5.js"><link rel="prefetch" href="/qishao-notes/assets/js/63.b9c3a1f9.js"><link rel="prefetch" href="/qishao-notes/assets/js/64.9110e239.js"><link rel="prefetch" href="/qishao-notes/assets/js/65.80788a32.js"><link rel="prefetch" href="/qishao-notes/assets/js/66.84550fae.js"><link rel="prefetch" href="/qishao-notes/assets/js/67.141cb180.js"><link rel="prefetch" href="/qishao-notes/assets/js/68.10a96040.js"><link rel="prefetch" href="/qishao-notes/assets/js/69.d3e74726.js"><link rel="prefetch" href="/qishao-notes/assets/js/7.de46b925.js"><link rel="prefetch" href="/qishao-notes/assets/js/70.44a7197c.js"><link rel="prefetch" href="/qishao-notes/assets/js/71.6df39a49.js"><link rel="prefetch" href="/qishao-notes/assets/js/72.9edff789.js"><link rel="prefetch" href="/qishao-notes/assets/js/73.242c3278.js"><link rel="prefetch" href="/qishao-notes/assets/js/74.65018581.js"><link rel="prefetch" href="/qishao-notes/assets/js/75.2cc978a8.js"><link rel="prefetch" href="/qishao-notes/assets/js/76.e9423d0f.js"><link rel="prefetch" href="/qishao-notes/assets/js/77.0b200c98.js"><link rel="prefetch" href="/qishao-notes/assets/js/78.b6869be2.js"><link rel="prefetch" href="/qishao-notes/assets/js/79.d0c64796.js"><link rel="prefetch" href="/qishao-notes/assets/js/8.b6a1e324.js"><link rel="prefetch" href="/qishao-notes/assets/js/80.4860609f.js"><link rel="prefetch" href="/qishao-notes/assets/js/81.37a17eb0.js"><link rel="prefetch" href="/qishao-notes/assets/js/82.d72017e1.js"><link rel="prefetch" href="/qishao-notes/assets/js/83.e927151e.js"><link rel="prefetch" href="/qishao-notes/assets/js/84.387e755d.js"><link rel="prefetch" href="/qishao-notes/assets/js/85.46751589.js"><link rel="prefetch" href="/qishao-notes/assets/js/86.352afce0.js"><link rel="prefetch" href="/qishao-notes/assets/js/87.a74e7ed7.js"><link rel="prefetch" href="/qishao-notes/assets/js/88.67ad5722.js"><link rel="prefetch" href="/qishao-notes/assets/js/89.0ac5f9af.js"><link rel="prefetch" href="/qishao-notes/assets/js/9.eaed4e75.js"><link rel="prefetch" href="/qishao-notes/assets/js/90.c2a18bd4.js"><link rel="prefetch" href="/qishao-notes/assets/js/91.fed767bd.js"><link rel="prefetch" href="/qishao-notes/assets/js/92.b6ef9851.js"><link rel="prefetch" href="/qishao-notes/assets/js/93.7d9d175e.js"><link rel="prefetch" href="/qishao-notes/assets/js/94.270fc0c6.js"><link rel="prefetch" href="/qishao-notes/assets/js/95.81cbde0d.js"><link rel="prefetch" href="/qishao-notes/assets/js/96.ca2f36ff.js"><link rel="prefetch" href="/qishao-notes/assets/js/97.1d59b90c.js"><link rel="prefetch" href="/qishao-notes/assets/js/98.969bc732.js"><link rel="prefetch" href="/qishao-notes/assets/js/99.a5264724.js">
    <link rel="stylesheet" href="/qishao-notes/assets/css/0.styles.b5ad55b3.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/qishao-notes/" class="home-link router-link-active"><!----> <span class="site-name">CPU &amp; GPU Microarch. Qi Shao</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/qishao-notes/" class="nav-link">Home</a></div><div class="nav-item"><a href="/qishao-notes/gpu/" class="nav-link">gpu</a></div><div class="nav-item"><a href="/qishao-notes/cpu/" class="nav-link">cpu</a></div><div class="nav-item"><a href="/qishao-notes/llm/" class="nav-link">ml&amp;llm</a></div><div class="nav-item"><a href="/qishao-notes/compiler/" class="nav-link">compiler</a></div><div class="nav-item"><a href="/qishao-notes/hbm/" class="nav-link">hbm</a></div><div class="nav-item"><a href="/qishao-notes/mix/" class="nav-link">program</a></div><div class="nav-item"><a href="/qishao-notes/unix/" class="nav-link">unix</a></div><div class="nav-item"><a href="https://blog.csdn.net/hit_shaoqi" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/hitqshao/qishao-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/qishao-notes/" class="nav-link">Home</a></div><div class="nav-item"><a href="/qishao-notes/gpu/" class="nav-link">gpu</a></div><div class="nav-item"><a href="/qishao-notes/cpu/" class="nav-link">cpu</a></div><div class="nav-item"><a href="/qishao-notes/llm/" class="nav-link">ml&amp;llm</a></div><div class="nav-item"><a href="/qishao-notes/compiler/" class="nav-link">compiler</a></div><div class="nav-item"><a href="/qishao-notes/hbm/" class="nav-link">hbm</a></div><div class="nav-item"><a href="/qishao-notes/mix/" class="nav-link">program</a></div><div class="nav-item"><a href="/qishao-notes/unix/" class="nav-link">unix</a></div><div class="nav-item"><a href="https://blog.csdn.net/hit_shaoqi" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/hitqshao/qishao-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/qishao-notes/pages/dc7035/" class="sidebar-link">how LLM works</a></li><li><a href="/qishao-notes/pages/dc7036/" class="sidebar-link">LLM Hardware Optimization</a></li><li><a href="/qishao-notes/pages/dc7037/" class="sidebar-link">How to run llama.cpp with gem5</a></li><li><a href="/qishao-notes/pages/dc7038/" class="sidebar-link">Memory Usage in Training LLM</a></li><li><a href="/qishao-notes/pages/dc7039/" class="sidebar-link">LLM optimizations</a></li><li><a href="/qishao-notes/pages/dc7040/" class="sidebar-link">LLM flash algorthms</a></li><li><a href="/qishao-notes/pages/dc7041/" class="sidebar-link">LLM compute &amp; memory bound</a></li><li><a href="/qishao-notes/pages/dc7042/" class="sidebar-link">LLM Paper List</a></li><li><a href="/qishao-notes/pages/dc7043/" class="sidebar-link">Efficient LLM</a></li><li><a href="/qishao-notes/pages/dc7045/" class="sidebar-link">Estimation of LLM</a></li><li><a href="/qishao-notes/pages/dc7046/" class="sidebar-link">Summery of Inner Workings of LLM</a></li><li><a href="/qishao-notes/pages/dc7047/" class="sidebar-link">List of LLM Optimization Techniques</a></li><li><a href="/qishao-notes/pages/dc7048/" class="sidebar-link">Memory Optimizations in LLM</a></li><li><a href="/qishao-notes/pages/dc7049/" class="sidebar-link">Reasoning in LLM</a></li><li><a href="/qishao-notes/pages/dc7050/" class="sidebar-link">LLM Mixed Precision &amp; Quantization &amp; Outlier</a></li><li><a href="/qishao-notes/pages/dc7051/" class="sidebar-link">LLM Sparsity</a></li><li><a href="/qishao-notes/pages/dc7052/" class="sidebar-link">LLM Scaling Law</a></li><li><a href="/qishao-notes/pages/dc7055/" aria-current="page" class="active sidebar-link">LLM Attention</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/qishao-notes/pages/dc7055/#_1-742-a-multiscale-visualization-of-attention-in-the-transformer-model" class="sidebar-link">1.[742] A Multiscale Visualization of Attention in the Transformer Model</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/qishao-notes/pages/dc7055/#key-findings" class="sidebar-link">Key Findings:</a></li><li class="sidebar-sub-header level3"><a href="/qishao-notes/pages/dc7055/#additional-findings" class="sidebar-link">Additional Findings:</a></li><li class="sidebar-sub-header level3"><a href="/qishao-notes/pages/dc7055/#future-work" class="sidebar-link">Future Work:</a></li><li class="sidebar-sub-header level3"><a href="/qishao-notes/pages/dc7055/#conclusion" class="sidebar-link">Conclusion:</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/qishao-notes/pages/dc7055/#_2-1910-what-does-bert-look-at-an-analysis-of-bert-s-attention" class="sidebar-link">2.[1910] What Does BERT Look At? An Analysis of BERT’s Attention</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/qishao-notes/pages/dc7055/#key-findings-2" class="sidebar-link">Key Findings:</a></li><li class="sidebar-sub-header level3"><a href="/qishao-notes/pages/dc7055/#contributions" class="sidebar-link">Contributions:</a></li><li class="sidebar-sub-header level3"><a href="/qishao-notes/pages/dc7055/#conclusion-2" class="sidebar-link">Conclusion:</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/qishao-notes/pages/dc7055/#_3-626-transformer-feed-forward-layers-are-key-value-memories" class="sidebar-link">3. [626] Transformer Feed-Forward Layers Are Key-Value Memories</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/qishao-notes/pages/dc7055/#key-findings-3" class="sidebar-link">Key Findings:</a></li><li class="sidebar-sub-header level3"><a href="/qishao-notes/pages/dc7055/#contributions-2" class="sidebar-link">Contributions:</a></li><li class="sidebar-sub-header level3"><a href="/qishao-notes/pages/dc7055/#implications" class="sidebar-link">Implications:</a></li><li class="sidebar-sub-header level3"><a href="/qishao-notes/pages/dc7055/#conclusion-3" class="sidebar-link">Conclusion:</a></li></ul></li></ul></li><li><a href="/qishao-notes/pages/dc7056/" class="sidebar-link">LLM KV Cache Management</a></li><li><a href="/qishao-notes/pages/dc7057/" class="sidebar-link">LLM Distributed Machine Learning</a></li><li><a href="/qishao-notes/pages/dc7059/" class="sidebar-link">LLM Internals</a></li><li><a href="/qishao-notes/pages/dc7058/" class="sidebar-link">LLM Posttraining/Finetuning</a></li><li><a href="/qishao-notes/pages/dc7060/" class="sidebar-link">LLM MOE Inference</a></li><li><a href="/qishao-notes/pages/dc7061/" class="sidebar-link">LLM Compression</a></li><li><a href="/qishao-notes/pages/dc7062/" class="sidebar-link">LLM Optimizer Optimization</a></li><li><a href="/qishao-notes/pages/dc7063/" class="sidebar-link">LLM Posttraining</a></li><li><a href="/qishao-notes/pages/dc7064/" class="sidebar-link">LLM MICRO - ISCA - HPCA</a></li><li><a href="/qishao-notes/pages/dc7066/" class="sidebar-link">LLM Prefilling &amp; Decoding Split</a></li><li><a href="/qishao-notes/pages/dc7067/" class="sidebar-link">Thinking of LLM Prefilling &amp; Decoding Split</a></li><li><a href="/qishao-notes/pages/dc7068/" class="sidebar-link">From Attention Sink to Massive Activation</a></li><li><a href="/qishao-notes/pages/dc7069/" class="sidebar-link">LLM CPU &amp; GPU Workloads</a></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper bg-style-6"><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/qishao-notes/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/qishao-notes/llm/#llm" data-v-06225672>llm</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/hitqshao" target="_blank" title="作者" class="beLink" data-v-06225672>hitqishao</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2025-02-05</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">LLM Attention<!----></h1> <!----> <div class="theme-vdoing-content content__default"><ol><li>[742] A Multiscale Visualization of Attention in the Transformer Model 👍</li> <li>[1910] What Does BERT Look At? An Analysis of BERT’s Attention</li> <li>[626] Transformer Feed-Forward Layers Are Key-Value Memories 👍</li> <li>[102] Attention Flows: Analyzing and Comparing Attention Mechanisms in Language Models</li></ol> <hr> <h2 id="_1-742-a-multiscale-visualization-of-attention-in-the-transformer-model"><a href="#_1-742-a-multiscale-visualization-of-attention-in-the-transformer-model" class="header-anchor">#</a> 1.[742] A Multiscale Visualization of Attention in the Transformer Model</h2> <p>The paper, &quot;A Multiscale Visualization of Attention in the Transformer Model&quot; by Jesse Vig, introduces an open-source tool designed to visualize attention mechanisms in Transformer-based models like BERT and GPT-2.<br>
The tool provides three distinct views: Attention-head view, Model view, and Neuron view, each offering a unique perspective on how attention operates at different scales within the model.<br>
The tool aims to make the multi-layer, multi-head attention mechanism more interpretable, helping researchers and practitioners understand how the model assigns weights to different input elements.</p> <h3 id="key-findings"><a href="#key-findings" class="header-anchor">#</a> Key Findings:</h3> <h4 id="attention-head-view"><a href="#attention-head-view" class="header-anchor">#</a> Attention-head View:</h4> <ul><li>Function: Visualizes attention patterns produced by one or more attention heads in a given layer.</li> <li>Key Insights:
<ul><li>Different heads learn unique attention mechanisms.
For example, some heads focus on <strong>positional patterns (e.g., attending to the previous word), while others capture lexical patterns (e.g., named entities, subject-verb pairs)</strong>.</li> <li>Attention heads can detect <strong>syntactic and semantic relations, such as dependency relations and part-of-speech tags</strong>.</li> <li>Use Case: Detecting model bias, such as gender bias in coreference resolution.
For instance, the model may associate &quot;She&quot; with &quot;nurse&quot; and &quot;He&quot; with &quot;doctor,&quot; indicating potential gender bias.</li></ul></li></ul> <p><img src="https://github.com/user-attachments/assets/fb797584-2b55-427b-8198-77b00f3de17e" alt="image"></p> <h4 id="model-view"><a href="#model-view" class="header-anchor">#</a> Model View:</h4> <ul><li>Function: Provides a high-level overview of attention across all layers and heads for a given input.</li> <li>Key Insights:
<ul><li>Attention patterns evolve across layers, with some heads focusing on within-sentence patterns and others on between-sentence patterns.</li> <li>The model view helps identify relevant heads for specific tasks, such as paraphrase detection, where heads that draw connections between sentences are particularly useful.</li> <li>Use Case: Locating relevant attention heads for tasks like paraphrase detection, where inter-sentence attention patterns are crucial.</li></ul></li></ul> <h4 id="neuron-view"><a href="#neuron-view" class="header-anchor">#</a> Neuron View:</h4> <ul><li>Function: Visualizes how individual neurons in the query and key vectors interact to produce attention.</li> <li>Key Insights:
<ul><li>The neuron view reveals how specific neurons contribute to attention patterns, such as distance-decaying attention (where attention decreases with distance from the source token).</li> <li>Certain neurons are responsible for specific attention behaviors, and modifying these neurons could control attention patterns (e.g., adjusting the decay rate for different text complexities).</li> <li>Use Case: Linking neurons to model behavior, allowing for potential interventions to control attention mechanisms.</li></ul></li></ul> <h3 id="additional-findings"><a href="#additional-findings" class="header-anchor">#</a> Additional Findings:</h3> <h4 id="attention-patterns"><a href="#attention-patterns" class="header-anchor">#</a> Attention Patterns:</h4> <p>Attention heads capture a wide range of behaviors, from coarse positional patterns to specific lexical and syntactic patterns.
Some heads are specialized for tasks like coreference resolution, while others focus on syntactic structures or semantic relationships.</p> <h4 id="model-bias"><a href="#model-bias" class="header-anchor">#</a> Model Bias:</h4> <p>The tool can help detect and analyze biases in the model, such as gender bias in coreference resolution, by visualizing attention patterns associated with biased predictions.</p> <h4 id="intervention-opportunities"><a href="#intervention-opportunities" class="header-anchor">#</a> Intervention Opportunities:</h4> <p>The neuron view provides insights into how specific neurons influence attention, offering opportunities for model intervention.<br>
For example, modifying neurons responsible for attention decay could adjust the context window size, which might be useful for generating texts of varying complexity.</p> <h3 id="future-work"><a href="#future-work" class="header-anchor">#</a> Future Work:</h3> <p>The authors plan to develop a unified interface for navigating all three views within the tool.<br>
They aim to expose other components of the model, such as value vectors and state activations.<br>
The tool could be extended to allow users to manipulate the model by modifying attention or editing individual neurons.</p> <h3 id="conclusion"><a href="#conclusion" class="header-anchor">#</a> Conclusion:</h3> <p>The paper presents a powerful visualization tool that enhances the interpretability of Transformer models by providing multiscale views of attention mechanisms.<br>
The tool not only helps in understanding how attention works in these models but also aids in detecting biases, locating relevant attention heads, and linking neurons to specific model behaviors.<br>
This work opens up new possibilities for model analysis and intervention, contributing to the broader goal of making complex neural models more transparent and controllable.</p> <hr> <h2 id="_2-1910-what-does-bert-look-at-an-analysis-of-bert-s-attention"><a href="#_2-1910-what-does-bert-look-at-an-analysis-of-bert-s-attention" class="header-anchor">#</a> 2.[1910] What Does BERT Look At? An Analysis of BERT’s Attention</h2> <p>The paper &quot;What Does BERT Look At? An Analysis of BERT's Attention&quot; by Kevin Clark, Urvashi Khandelwal, Omer Levy, and Christopher D. Manning investigates the attention mechanisms within BERT, a large pre-trained Transformer model, to understand what linguistic features it learns from unlabeled data. The authors propose methods for analyzing BERT's attention maps and apply them to uncover patterns and behaviors of its attention heads.</p> <h3 id="key-findings-2"><a href="#key-findings-2" class="header-anchor">#</a> Key Findings:</h3> <h4 id="attention-patterns-2"><a href="#attention-patterns-2" class="header-anchor">#</a> Attention Patterns:</h4> <p>BERT's attention heads exhibit common patterns such as attending to specific positional offsets, delimiter tokens (e.g., [SEP]), or broadly attending over the entire sentence.</p> <p>A significant amount of attention is focused on the [SEP] token, which the authors hypothesize acts as a &quot;no-op&quot; (no operation) when the attention head's function is not applicable.</p> <blockquote><p>qualitative analysis (see Figure 5) shows that heads with specific functions attend to [SEP] when the function is not called for.
For example, in head 8-10 direct objects attend to their verbs.
For this head, non-nouns mostly attend to [SEP].
Therefore, we speculate that attention over these special tokens might be used as a sort of “no-op” when the attention head’s function is not applicable.</p></blockquote> <h4 id="linguistic-phenomena"><a href="#linguistic-phenomena" class="header-anchor">#</a> Linguistic Phenomena:</h4> <p>Certain attention heads correspond well to linguistic notions of syntax and coreference. For example, some heads accurately attend to direct objects of verbs, determiners of nouns, objects of prepositions, and coreferent mentions.</p> <p>The authors propose an attention-based probing classifier, which achieves 77% Unlabeled Attachment Score (UAS) in dependency parsing, indicating that BERT's attention captures substantial syntactic information.</p> <h4 id="individual-attention-heads"><a href="#individual-attention-heads" class="header-anchor">#</a> Individual Attention Heads:</h4> <p>Individual attention heads specialize in specific syntactic relations, such as prepositions attending to their objects or nouns attending to their determiners, with high accuracy.</p> <p>One attention head performs well in coreference resolution, particularly for nominal mentions, suggesting that BERT learns some aspects of coreference without explicit supervision.</p> <h4 id="attention-head-combinations"><a href="#attention-head-combinations" class="header-anchor">#</a> Attention Head Combinations:</h4> <p>The authors propose probing classifiers that combine attention maps from multiple heads, showing that BERT's attention maps collectively capture a thorough representation of English syntax.</p> <h4 id="clustering-of-attention-heads"><a href="#clustering-of-attention-heads" class="header-anchor">#</a> Clustering of Attention Heads:</h4> <p>Attention heads within the same layer tend to behave similarly, and some heads form clear clusters based on their behavior. This redundancy might be due to attention dropout during training.</p> <h3 id="contributions"><a href="#contributions" class="header-anchor">#</a> Contributions:</h3> <p>The paper provides a detailed analysis of BERT's attention mechanisms, revealing that BERT learns significant syntactic and coreference information through self-supervised training.</p> <p>The authors introduce novel methods for probing attention maps, demonstrating that attention-based analysis complements other model analysis techniques.</p> <h3 id="conclusion-2"><a href="#conclusion-2" class="header-anchor">#</a> Conclusion:</h3> <p>The study shows that BERT's attention mechanisms capture a substantial amount of linguistic knowledge, particularly syntax and coreference, even though the model is not explicitly trained for these tasks.<br>
The findings suggest that pre-training on large corpora enables BERT to learn complex linguistic structures indirectly, which contributes to its success in various NLP tasks.<br>
The paper also highlights the importance of analyzing attention maps to better understand what neural networks learn about language.</p> <p><img src="https://github.com/user-attachments/assets/973c45be-0592-48c5-a8f7-1bf6638e0fe2" alt="image"></p> <hr> <h2 id="_3-626-transformer-feed-forward-layers-are-key-value-memories"><a href="#_3-626-transformer-feed-forward-layers-are-key-value-memories" class="header-anchor">#</a> 3. [626] Transformer Feed-Forward Layers Are Key-Value Memories</h2> <p>👍 <em>This is a good paper that deserves further reading.</em></p> <p>The authors argue that these layers, which constitute two-thirds of a transformer's parameters, function as key-value memories, where keys detect specific input patterns and values induce distributions over the output vocabulary.</p> <p>The paper provides empirical evidence to support this claim and explores how these memories contribute to the model's predictions.</p> <h3 id="key-findings-3"><a href="#key-findings-3" class="header-anchor">#</a> Key Findings:</h3> <h4 id="feed-forward-layers-as-key-value-memories"><a href="#feed-forward-layers-as-key-value-memories" class="header-anchor">#</a> Feed-Forward Layers as Key-Value Memories:</h4> <p>The feed-forward layers in transformers can be viewed as key-value memories, where the first matrix (keys) detects input patterns, and the second matrix (values) induces distributions over the output vocabulary.</p> <p>Each key correlates with specific textual patterns in the training data, and the corresponding value represents the distribution of tokens likely to follow that pattern.</p> <h4 id="interpretable-patterns-in-keys"><a href="#interpretable-patterns-in-keys" class="header-anchor">#</a> Interpretable Patterns in Keys:</h4> <p>The keys in feed-forward layers capture human-interpretable patterns in the input. Lower layers tend to detect shallow patterns (e.g., n-grams), while upper layers capture more semantic patterns (e.g., topics or contexts).</p> <p>Experiments show that the top trigger examples for each key share clear, recognizable patterns, and these patterns become more semantic as the layer depth increases.</p> <h4 id="values-as-output-distributions"><a href="#values-as-output-distributions" class="header-anchor">#</a> Values as Output Distributions:</h4> <p>The values in feed-forward layers can be interpreted as distributions over the output vocabulary.</p> <p>In upper layers, these distributions often align with the next-token predictions for the patterns detected by the corresponding keys.</p> <p>The agreement between the value's top prediction and the next token in the trigger example increases significantly in the upper layers, indicating that these layers are more predictive of the output.</p> <p><img src="https://github.com/user-attachments/assets/218bede0-9617-447c-ac8b-4b69bf26abee" alt="image"></p> <h4 id="memory-composition-and-refinement"><a href="#memory-composition-and-refinement" class="header-anchor">#</a> Memory Composition and Refinement:</h4> <p>The output of a feed-forward layer is a composition of multiple memories, where hundreds of active memories contribute to the final distribution.</p> <p>The layer's prediction is often different from the predictions of individual memories, suggesting a complex aggregation process.</p> <p>The model refines its predictions through residual connections across layers. Lower layers often determine the final prediction, while upper layers fine-tune the distribution.</p> <h4 id="layer-wise-behavior"><a href="#layer-wise-behavior" class="header-anchor">#</a> Layer-Wise Behavior:</h4> <p>Lower layers focus on shallow patterns and have a higher number of active memories, while upper layers focus on semantic patterns and exhibit fewer active memories.</p> <p><img src="https://github.com/user-attachments/assets/8cb44c86-6a6e-4082-8a28-99f5f7a26003" alt="image"></p> <p>The model's predictions are refined sequentially, with the residual connections playing a crucial role in combining and refining the predictions from each layer.</p> <p><img src="https://github.com/user-attachments/assets/d78fa44d-6f49-44e4-aed2-62514fa49fc8" alt="image"></p> <p><img src="https://github.com/user-attachments/assets/b26d8b9e-bd48-470f-8109-3bb84d9bd0e0" alt="image"></p> <h3 id="contributions-2"><a href="#contributions-2" class="header-anchor">#</a> Contributions:</h3> <p>The paper provides a novel interpretation of feed-forward layers in transformers as key-value memories, shedding light on their role in the model's predictions.</p> <p>It demonstrates that feed-forward layers capture interpretable patterns in the input and that these patterns evolve from shallow to semantic as the layer depth increases.</p> <p>The study shows how the model composes and refines its predictions through the aggregation of memories and residual connections.</p> <h3 id="implications"><a href="#implications" class="header-anchor">#</a> Implications:</h3> <p>The findings open new research directions, including understanding the embedding space transformation across layers, extending the analysis to other transformer models (e.g., BERT), and exploring practical implications for interpretability and data privacy.</p> <p>The paper suggests that feed-forward layers play a crucial role in the model's ability to capture and predict linguistic patterns, contributing to the overall success of transformer-based language models.</p> <h3 id="conclusion-3"><a href="#conclusion-3" class="header-anchor">#</a> Conclusion:</h3> <p>The paper advances our understanding of the inner workings of transformers by revealing that feed-forward layers act as key-value memories that detect input patterns and induce output distributions.</p> <p>This work highlights the importance of feed-forward layers in the model's predictions and provides a foundation for further research into the mechanisms of transformer-based models.</p> <hr></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/hitqshao/qishao-notes/edit/main/docs/05.llm/18.llm_att.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2025/05/16, 23:44:52</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/qishao-notes/pages/dc7052/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">LLM Scaling Law</div></a> <a href="/qishao-notes/pages/dc7056/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">LLM KV Cache Management</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/qishao-notes/pages/dc7052/" class="prev">LLM Scaling Law</a></span> <span class="next"><a href="/qishao-notes/pages/dc7056/">LLM KV Cache Management</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="https://github.com/hitqshao" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="mailto:hitqshao@163.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://gitee.com/hitqshao" title="Gitee" target="_blank" class="iconfont icon-gitee"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2025
    <span>Eryajf | <a href="https://github.com/hitqshao/qishao-notes/blob/main/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><!----></div></div>
    <script src="/qishao-notes/assets/js/app.22de7e07.js" defer></script><script src="/qishao-notes/assets/js/2.0833fe67.js" defer></script><script src="/qishao-notes/assets/js/105.bf5d1820.js" defer></script>
  </body>
</html>
