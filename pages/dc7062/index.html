<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>LLM Optimizer Optimization | CPU &amp; GPU Microarch. Qi Shao</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="stylesheet" href="custom.css">
    <script language="javascript" type="text/javascript" src="/qishao-notes/js/pgmanor-self.js"></script>
    <meta name="description" content="Computer System">
    <meta name="google-site-verification" content="66w5U9NY5gJWu7iBtHKMbhpXkV94jy31L_RHbvrZZzY">
    <meta name="keywords" content="Hitqishao,golang,vue,go-web,go-admin,go-ldap-admin">
    <meta name="theme-color" content="#11a8cd">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <link rel="preload" href="/qishao-notes/assets/css/0.styles.b5ad55b3.css" as="style"><link rel="preload" href="/qishao-notes/assets/js/app.b992b4f5.js" as="script"><link rel="preload" href="/qishao-notes/assets/js/2.0833fe67.js" as="script"><link rel="preload" href="/qishao-notes/assets/js/109.a988f42e.js" as="script"><link rel="prefetch" href="/qishao-notes/assets/js/10.d6069d94.js"><link rel="prefetch" href="/qishao-notes/assets/js/100.efe4e18e.js"><link rel="prefetch" href="/qishao-notes/assets/js/101.d344979b.js"><link rel="prefetch" href="/qishao-notes/assets/js/102.6bc1dc1a.js"><link rel="prefetch" href="/qishao-notes/assets/js/103.752dc056.js"><link rel="prefetch" href="/qishao-notes/assets/js/104.fb36554a.js"><link rel="prefetch" href="/qishao-notes/assets/js/105.c328df02.js"><link rel="prefetch" href="/qishao-notes/assets/js/106.30fdcc2e.js"><link rel="prefetch" href="/qishao-notes/assets/js/107.e17d34f0.js"><link rel="prefetch" href="/qishao-notes/assets/js/108.a8421c68.js"><link rel="prefetch" href="/qishao-notes/assets/js/11.09348d5e.js"><link rel="prefetch" href="/qishao-notes/assets/js/110.908d8256.js"><link rel="prefetch" href="/qishao-notes/assets/js/111.888f2fe3.js"><link rel="prefetch" href="/qishao-notes/assets/js/112.c72d74fe.js"><link rel="prefetch" href="/qishao-notes/assets/js/113.de852cdc.js"><link rel="prefetch" href="/qishao-notes/assets/js/114.9986ebf1.js"><link rel="prefetch" href="/qishao-notes/assets/js/115.6a8ed08a.js"><link rel="prefetch" href="/qishao-notes/assets/js/116.e0bf79a5.js"><link rel="prefetch" href="/qishao-notes/assets/js/117.d217c2fa.js"><link rel="prefetch" href="/qishao-notes/assets/js/118.80d6079b.js"><link rel="prefetch" href="/qishao-notes/assets/js/119.d0f02497.js"><link rel="prefetch" href="/qishao-notes/assets/js/12.f7afb48a.js"><link rel="prefetch" href="/qishao-notes/assets/js/120.db5dd78f.js"><link rel="prefetch" href="/qishao-notes/assets/js/121.058fb67a.js"><link rel="prefetch" href="/qishao-notes/assets/js/122.67c7b28b.js"><link rel="prefetch" href="/qishao-notes/assets/js/123.ee019bb2.js"><link rel="prefetch" href="/qishao-notes/assets/js/124.bc005d69.js"><link rel="prefetch" href="/qishao-notes/assets/js/125.c5c8d21d.js"><link rel="prefetch" href="/qishao-notes/assets/js/126.4e34b166.js"><link rel="prefetch" href="/qishao-notes/assets/js/127.cbd7af71.js"><link rel="prefetch" href="/qishao-notes/assets/js/128.c4f70424.js"><link rel="prefetch" href="/qishao-notes/assets/js/129.5b74727a.js"><link rel="prefetch" href="/qishao-notes/assets/js/13.75d8be97.js"><link rel="prefetch" href="/qishao-notes/assets/js/130.8bd9606a.js"><link rel="prefetch" href="/qishao-notes/assets/js/131.7bf8633a.js"><link rel="prefetch" href="/qishao-notes/assets/js/132.8f6e1e21.js"><link rel="prefetch" href="/qishao-notes/assets/js/14.466ec3ac.js"><link rel="prefetch" href="/qishao-notes/assets/js/15.e89652e9.js"><link rel="prefetch" href="/qishao-notes/assets/js/16.383840b9.js"><link rel="prefetch" href="/qishao-notes/assets/js/17.63fdd997.js"><link rel="prefetch" href="/qishao-notes/assets/js/18.bc4a5b1d.js"><link rel="prefetch" href="/qishao-notes/assets/js/19.a2c2ac4d.js"><link rel="prefetch" href="/qishao-notes/assets/js/20.a4b6fb1c.js"><link rel="prefetch" href="/qishao-notes/assets/js/21.58619e3b.js"><link rel="prefetch" href="/qishao-notes/assets/js/22.b2f9c634.js"><link rel="prefetch" href="/qishao-notes/assets/js/23.4d4cd4e1.js"><link rel="prefetch" href="/qishao-notes/assets/js/24.88ca611d.js"><link rel="prefetch" href="/qishao-notes/assets/js/25.54245a6c.js"><link rel="prefetch" href="/qishao-notes/assets/js/26.ab4d38ce.js"><link rel="prefetch" href="/qishao-notes/assets/js/27.ae348b88.js"><link rel="prefetch" href="/qishao-notes/assets/js/28.781915d4.js"><link rel="prefetch" href="/qishao-notes/assets/js/29.9921982f.js"><link rel="prefetch" href="/qishao-notes/assets/js/3.b67a85e5.js"><link rel="prefetch" href="/qishao-notes/assets/js/30.93526d40.js"><link rel="prefetch" href="/qishao-notes/assets/js/31.aa6fd9d8.js"><link rel="prefetch" href="/qishao-notes/assets/js/32.b6eb8bb3.js"><link rel="prefetch" href="/qishao-notes/assets/js/33.530df744.js"><link rel="prefetch" href="/qishao-notes/assets/js/34.54012013.js"><link rel="prefetch" href="/qishao-notes/assets/js/35.01d6cf82.js"><link rel="prefetch" href="/qishao-notes/assets/js/36.c355ce28.js"><link rel="prefetch" href="/qishao-notes/assets/js/37.6cb48c78.js"><link rel="prefetch" href="/qishao-notes/assets/js/38.9f9585d9.js"><link rel="prefetch" href="/qishao-notes/assets/js/39.7f09c090.js"><link rel="prefetch" href="/qishao-notes/assets/js/4.2dcb8de5.js"><link rel="prefetch" href="/qishao-notes/assets/js/40.3f307496.js"><link rel="prefetch" href="/qishao-notes/assets/js/41.a14373c1.js"><link rel="prefetch" href="/qishao-notes/assets/js/42.36f25851.js"><link rel="prefetch" href="/qishao-notes/assets/js/43.9a39b8df.js"><link rel="prefetch" href="/qishao-notes/assets/js/44.be5d1eda.js"><link rel="prefetch" href="/qishao-notes/assets/js/45.a99569c7.js"><link rel="prefetch" href="/qishao-notes/assets/js/46.86177f5e.js"><link rel="prefetch" href="/qishao-notes/assets/js/47.3c3f4c37.js"><link rel="prefetch" href="/qishao-notes/assets/js/48.74d6845e.js"><link rel="prefetch" href="/qishao-notes/assets/js/49.14c8f20a.js"><link rel="prefetch" href="/qishao-notes/assets/js/5.9d58ea7e.js"><link rel="prefetch" href="/qishao-notes/assets/js/50.1d0bbfe1.js"><link rel="prefetch" href="/qishao-notes/assets/js/51.a1fb9aec.js"><link rel="prefetch" href="/qishao-notes/assets/js/52.a8217417.js"><link rel="prefetch" href="/qishao-notes/assets/js/53.00cfb273.js"><link rel="prefetch" href="/qishao-notes/assets/js/54.0467e711.js"><link rel="prefetch" href="/qishao-notes/assets/js/55.545b33b8.js"><link rel="prefetch" href="/qishao-notes/assets/js/56.c59442b1.js"><link rel="prefetch" href="/qishao-notes/assets/js/57.89586274.js"><link rel="prefetch" href="/qishao-notes/assets/js/58.d8968a5e.js"><link rel="prefetch" href="/qishao-notes/assets/js/59.5a90503c.js"><link rel="prefetch" href="/qishao-notes/assets/js/6.bca7e213.js"><link rel="prefetch" href="/qishao-notes/assets/js/60.257e363f.js"><link rel="prefetch" href="/qishao-notes/assets/js/61.d2bb5053.js"><link rel="prefetch" href="/qishao-notes/assets/js/62.f1be6ae5.js"><link rel="prefetch" href="/qishao-notes/assets/js/63.b9c3a1f9.js"><link rel="prefetch" href="/qishao-notes/assets/js/64.163b25e0.js"><link rel="prefetch" href="/qishao-notes/assets/js/65.80788a32.js"><link rel="prefetch" href="/qishao-notes/assets/js/66.1210062b.js"><link rel="prefetch" href="/qishao-notes/assets/js/67.1a157136.js"><link rel="prefetch" href="/qishao-notes/assets/js/68.5fa6476c.js"><link rel="prefetch" href="/qishao-notes/assets/js/69.a14cc445.js"><link rel="prefetch" href="/qishao-notes/assets/js/7.3eecfe51.js"><link rel="prefetch" href="/qishao-notes/assets/js/70.c6451aec.js"><link rel="prefetch" href="/qishao-notes/assets/js/71.6df39a49.js"><link rel="prefetch" href="/qishao-notes/assets/js/72.9edff789.js"><link rel="prefetch" href="/qishao-notes/assets/js/73.152a05af.js"><link rel="prefetch" href="/qishao-notes/assets/js/74.c29a1485.js"><link rel="prefetch" href="/qishao-notes/assets/js/75.cbac4120.js"><link rel="prefetch" href="/qishao-notes/assets/js/76.65bac2a1.js"><link rel="prefetch" href="/qishao-notes/assets/js/77.2bc797df.js"><link rel="prefetch" href="/qishao-notes/assets/js/78.1ac71d6e.js"><link rel="prefetch" href="/qishao-notes/assets/js/79.aa9320dc.js"><link rel="prefetch" href="/qishao-notes/assets/js/8.b6a1e324.js"><link rel="prefetch" href="/qishao-notes/assets/js/80.0f05ece6.js"><link rel="prefetch" href="/qishao-notes/assets/js/81.f990a16a.js"><link rel="prefetch" href="/qishao-notes/assets/js/82.e760ae06.js"><link rel="prefetch" href="/qishao-notes/assets/js/83.8d6ffbf5.js"><link rel="prefetch" href="/qishao-notes/assets/js/84.d35b0951.js"><link rel="prefetch" href="/qishao-notes/assets/js/85.6fa53d3a.js"><link rel="prefetch" href="/qishao-notes/assets/js/86.fa3c42d6.js"><link rel="prefetch" href="/qishao-notes/assets/js/87.e725c0e8.js"><link rel="prefetch" href="/qishao-notes/assets/js/88.728bcb07.js"><link rel="prefetch" href="/qishao-notes/assets/js/89.930d3386.js"><link rel="prefetch" href="/qishao-notes/assets/js/9.9ff8f5de.js"><link rel="prefetch" href="/qishao-notes/assets/js/90.640a49e5.js"><link rel="prefetch" href="/qishao-notes/assets/js/91.f13c6793.js"><link rel="prefetch" href="/qishao-notes/assets/js/92.7d415e16.js"><link rel="prefetch" href="/qishao-notes/assets/js/93.198b4a96.js"><link rel="prefetch" href="/qishao-notes/assets/js/94.9c2ee1f4.js"><link rel="prefetch" href="/qishao-notes/assets/js/95.bce2672e.js"><link rel="prefetch" href="/qishao-notes/assets/js/96.caf3b4d2.js"><link rel="prefetch" href="/qishao-notes/assets/js/97.3c98d117.js"><link rel="prefetch" href="/qishao-notes/assets/js/98.6dce913e.js"><link rel="prefetch" href="/qishao-notes/assets/js/99.3f361b43.js">
    <link rel="stylesheet" href="/qishao-notes/assets/css/0.styles.b5ad55b3.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/qishao-notes/" class="home-link router-link-active"><!----> <span class="site-name">CPU &amp; GPU Microarch. Qi Shao</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/qishao-notes/" class="nav-link">Home</a></div><div class="nav-item"><a href="/qishao-notes/gpu/" class="nav-link">gpu</a></div><div class="nav-item"><a href="/qishao-notes/cpu/" class="nav-link">cpu</a></div><div class="nav-item"><a href="/qishao-notes/llm/" class="nav-link">ml&amp;llm</a></div><div class="nav-item"><a href="/qishao-notes/compiler/" class="nav-link">compiler</a></div><div class="nav-item"><a href="/qishao-notes/hbm/" class="nav-link">hbm</a></div><div class="nav-item"><a href="/qishao-notes/mix/" class="nav-link">program</a></div><div class="nav-item"><a href="/qishao-notes/unix/" class="nav-link">unix</a></div><div class="nav-item"><a href="https://blog.csdn.net/hit_shaoqi" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/hitqshao/qishao-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/qishao-notes/" class="nav-link">Home</a></div><div class="nav-item"><a href="/qishao-notes/gpu/" class="nav-link">gpu</a></div><div class="nav-item"><a href="/qishao-notes/cpu/" class="nav-link">cpu</a></div><div class="nav-item"><a href="/qishao-notes/llm/" class="nav-link">ml&amp;llm</a></div><div class="nav-item"><a href="/qishao-notes/compiler/" class="nav-link">compiler</a></div><div class="nav-item"><a href="/qishao-notes/hbm/" class="nav-link">hbm</a></div><div class="nav-item"><a href="/qishao-notes/mix/" class="nav-link">program</a></div><div class="nav-item"><a href="/qishao-notes/unix/" class="nav-link">unix</a></div><div class="nav-item"><a href="https://blog.csdn.net/hit_shaoqi" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/hitqshao/qishao-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/qishao-notes/pages/dc7035/" class="sidebar-link">how LLM works</a></li><li><a href="/qishao-notes/pages/dc7036/" class="sidebar-link">LLM Hardware Optimization</a></li><li><a href="/qishao-notes/pages/dc7037/" class="sidebar-link">How to run llama.cpp with gem5</a></li><li><a href="/qishao-notes/pages/dc7038/" class="sidebar-link">Memory Usage in Training LLM</a></li><li><a href="/qishao-notes/pages/dc7039/" class="sidebar-link">LLM optimizations</a></li><li><a href="/qishao-notes/pages/dc7040/" class="sidebar-link">LLM flash algorthms</a></li><li><a href="/qishao-notes/pages/dc7041/" class="sidebar-link">LLM compute &amp; memory bound</a></li><li><a href="/qishao-notes/pages/dc7042/" class="sidebar-link">LLM Paper List</a></li><li><a href="/qishao-notes/pages/dc7043/" class="sidebar-link">Efficient LLM</a></li><li><a href="/qishao-notes/pages/dc7045/" class="sidebar-link">Estimation of LLM</a></li><li><a href="/qishao-notes/pages/dc7046/" class="sidebar-link">Summery of Inner Workings of LLM</a></li><li><a href="/qishao-notes/pages/dc7047/" class="sidebar-link">List of LLM Optimization Techniques</a></li><li><a href="/qishao-notes/pages/dc7048/" class="sidebar-link">Memory Optimizations in LLM</a></li><li><a href="/qishao-notes/pages/dc7049/" class="sidebar-link">Reasoning in LLM</a></li><li><a href="/qishao-notes/pages/dc7050/" class="sidebar-link">LLM Mixed Precision &amp; Quantization &amp; Outlier</a></li><li><a href="/qishao-notes/pages/dc7051/" class="sidebar-link">LLM Sparsity</a></li><li><a href="/qishao-notes/pages/dc7052/" class="sidebar-link">LLM Scaling Law</a></li><li><a href="/qishao-notes/pages/dc7055/" class="sidebar-link">LLM Attention</a></li><li><a href="/qishao-notes/pages/dc7056/" class="sidebar-link">LLM KV Cache Management</a></li><li><a href="/qishao-notes/pages/dc7057/" class="sidebar-link">LLM Distributed Machine Learning</a></li><li><a href="/qishao-notes/pages/dc7059/" class="sidebar-link">LLM Internals</a></li><li><a href="/qishao-notes/pages/dc7058/" class="sidebar-link">LLM Posttraining/Finetuning</a></li><li><a href="/qishao-notes/pages/dc7060/" class="sidebar-link">LLM MOE Inference</a></li><li><a href="/qishao-notes/pages/dc7061/" class="sidebar-link">LLM Compression</a></li><li><a href="/qishao-notes/pages/dc7062/" aria-current="page" class="active sidebar-link">LLM Optimizer Optimization</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/qishao-notes/pages/dc7062/#_1-1-badam-a-memory-efficient-full-parameter-optimization-method-for-large-language-models" class="sidebar-link">1. [1] BAdam: A Memory Efficient Full Parameter Optimization Method for Large Language Models</a></li><li class="sidebar-sub-header level2"><a href="/qishao-notes/pages/dc7062/#_2-1075-adafactor-adaptive-learning-rates-with-sublinear-memory-cost" class="sidebar-link">2. [1075] Adafactor Adaptive Learning Rates with Sublinear Memory Cost</a></li><li class="sidebar-sub-header level2"><a href="/qishao-notes/pages/dc7062/#_3-adam-accumulation-to-reduce-memory-footprints-of-both-activations-and-gradients-for-large-scale-dnn-training" class="sidebar-link">[3] Adam Accumulation to Reduce Memory Footprints of both Activations and Gradients for Large-scale DNN Training</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/qishao-notes/pages/dc7062/#gradient-accumulation-gradient-release" class="sidebar-link">Gradient Accumulation &amp; Gradient Release</a></li><li class="sidebar-sub-header level3"><a href="/qishao-notes/pages/dc7062/#adam-accumulation-adama" class="sidebar-link">Adam Accumulation (AdamA)</a></li><li class="sidebar-sub-header level3"><a href="/qishao-notes/pages/dc7062/#elaboration" class="sidebar-link">Elaboration</a></li><li class="sidebar-sub-header level3"><a href="/qishao-notes/pages/dc7062/#mechanism" class="sidebar-link">Mechanism</a></li></ul></li></ul></li><li><a href="/qishao-notes/pages/dc7063/" class="sidebar-link">LLM Posttraining</a></li><li><a href="/qishao-notes/pages/dc7064/" class="sidebar-link">LLM MICRO - ISCA - HPCA</a></li><li><a href="/qishao-notes/pages/dc7066/" class="sidebar-link">LLM Prefilling &amp; Decoding Split</a></li><li><a href="/qishao-notes/pages/dc7067/" class="sidebar-link">Thinking of LLM Prefilling &amp; Decoding Split</a></li><li><a href="/qishao-notes/pages/dc7068/" class="sidebar-link">From Attention Sink to Massive Activation</a></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper bg-style-6"><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/qishao-notes/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/qishao-notes/llm/#llm" data-v-06225672>llm</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/hitqshao" target="_blank" title="作者" class="beLink" data-v-06225672>hitqishao</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2025-04-02</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">LLM Optimizer Optimization<!----></h1> <!----> <div class="theme-vdoing-content content__default"><ol><li>[1] BAdam: A Memory Efficient Full Parameter Optimization Method for Large Language Models</li> <li>[1075] Adafactor Adaptive Learning Rates with Sublinear Memory Cost</li> <li>[3] Adam Accumulation to Reduce Memory Footprints of both Activations and Gradients for Large-scale DNN Training</li></ol> <hr> <h2 id="_1-1-badam-a-memory-efficient-full-parameter-optimization-method-for-large-language-models"><a href="#_1-1-badam-a-memory-efficient-full-parameter-optimization-method-for-large-language-models" class="header-anchor">#</a> 1. [1] BAdam: A Memory Efficient Full Parameter Optimization Method for Large Language Models</h2> <p><strong>It change the finetuing into block coordinate descent (BCD)-type optimization</strong> which I dont understand.</p> <p>For instance, to finetune an LLM with M billion parameters, Adam [23] necessitates roughly 18M GB of GPU memory for successful training, and
this estimate does not even account for the storage of activations used in the backpropagation (BP) process.</p> <p>Despite the success of PEFT methods, finetuning within a substantially lower-dimensional subspace may potentially <strong>limit downstream performance</strong>.</p> <p><img src="https://github.com/user-attachments/assets/8def8b42-d493-4358-80bc-515746a2cc17" alt="image"></p> <p>We first analyze the memory cost of Adam with mixed precision training.</p> <p>One needs to store the FP16 model parameters for the BP process, which costs 2M memory.</p> <p>For a more precise update, the optimizer also maintains a master copy of a FP32 model, which costs 4M memory.</p> <p>Then, it comes to store the <strong>gradient (converted to FP32), momentum, and second moment</strong> in FP32 precision, costing <strong>4M + 4M + 4M = 12M</strong> memory.</p> <p>In total, Adam needs roughly <strong>18M memory</strong>.</p> <p>In terms of BAdam, it needs to store the up-to-date model parameters (see Figure 1) in FP16 precision, which costs 2M memory. Importantly, since BAdam only updates the active block at one time, we
can store the model parameters, gradient, momentum, and second moment only for the active block θπi in FP32 precision, where the FP32 model parameters and gradient of the active block can be
obtained by transforming their FP16 versions to the FP32 versions.</p> <p>Let us consider the simple case where the partitioned D blocks are equal-sized. Then, BAdam only needs in total</p> <p><img src="https://github.com/user-attachments/assets/f0ee0fbd-cf93-4b2b-a1b0-f7df945d5d16" alt="image"></p> <hr> <h2 id="_2-1075-adafactor-adaptive-learning-rates-with-sublinear-memory-cost"><a href="#_2-1075-adafactor-adaptive-learning-rates-with-sublinear-memory-cost" class="header-anchor">#</a> 2. [1075] Adafactor Adaptive Learning Rates with Sublinear Memory Cost</h2> <p>This paper introduces <strong>Adafactor</strong> , an optimization algorithm designed to provide <strong>adaptive learning rates with significantly reduced memory overhead</strong>  compared to traditional methods like Adam.</p> <p>The core innovation is replacing full per-parameter second-moment estimators (used to scale gradients) with <strong>factored approximations</strong>  based on the <strong>row and column sums</strong>  of squared gradients.</p> <p><strong>Similar to LORA, using only the per-row and percolumn sums of these moving averages, and estimating the per-parameter second moments based on these sums.</strong></p> <p>This change reduces memory usage from O(nm) to O(n + m) for matrix-shaped parameters.</p> <p>Key contributions and details include:</p> <ul><li><p><strong>Factored Second Moment Estimation</strong> :</p> <ul><li>Adafactor leverages a rank-1 approximation using the generalized Kullback-Leibler divergence to estimate the second moment of gradients.</li> <li>Instead of storing full-size accumulators, it maintains exponential moving averages of row and column sums, achieving memory savings while preserving empirical performance.</li> <li>A closed-form solution for the rank-1 approximation ensures computational efficiency and compatibility with exponential smoothing.</li></ul></li> <li><p><strong>Removing Momentum</strong> :</p> <ul><li><strong>Momentum (first moment) is omitted (β₁ = 0)</strong> to further reduce memory cost. This change initially causes instability, especially without learning rate warmup.</li></ul></li> <li><p><strong>Stabilizing Updates</strong> :</p> <ul><li><strong>Update Clipping</strong> : Caps the RMS of unscaled updates to avoid large, destabilizing parameter jumps due to outdated second-moment estimators.</li> <li><strong>Increasing β₂ Schedule</strong> : Proposes a decay schedule like β̂₂ₜ = 1 − t^(-c), which adapts over time and avoids the need for bias correction.</li> <li>These methods independently and jointly stabilize training in the absence of momentum and warmup.</li></ul></li> <li><p><strong>Relative Step Sizes</strong> :</p> <ul><li>Instead of fixed absolute learning rates, Adafactor uses <strong>parameter-relative step sizes</strong> , scaling updates based on the parameter norm, making it more resilient to differing parameter magnitudes (e.g., in embeddings).</li></ul></li> <li><p><strong>Experiments</strong> :</p> <ul><li>Conducted on Transformer models for WMT’14 En→De machine translation.</li> <li>Adafactor with factored moments, no momentum, update clipping, increasing decay rate, and relative step sizes performs comparably to Adam while using less memory.</li> <li>Results show robustness to poor parameter initialization and scaling, unlike Adam.</li></ul></li> <li><p><strong>Practical Use</strong> :</p> <ul><li>Adafactor enables training larger models on memory-constrained hardware.</li> <li>Implementation is available in the Tensor2Tensor library.</li></ul></li></ul> <p><strong>Three-Sentence Summary:</strong></p> <p>The paper proposes <strong>Adafactor</strong> , a memory-efficient optimizer that approximates second-moment estimators using factored row and column sums, drastically reducing auxiliary memory usage from O(nm) to O(n + m).</p> <p>To address instability caused by omitting momentum and slow-decaying estimators, the authors introduce <strong>update clipping</strong>  and an <strong>increasing decay schedule</strong> , both of which stabilize training.</p> <p>Combined with <strong>relative step sizes</strong> , Adafactor achieves comparable performance to Adam on large-scale Transformer tasks while enabling significantly larger models on limited hardware.</p> <hr> <h2 id="_3-adam-accumulation-to-reduce-memory-footprints-of-both-activations-and-gradients-for-large-scale-dnn-training"><a href="#_3-adam-accumulation-to-reduce-memory-footprints-of-both-activations-and-gradients-for-large-scale-dnn-training" class="header-anchor">#</a> [3] Adam Accumulation to Reduce Memory Footprints of both Activations and Gradients for Large-scale DNN Training</h2> <h3 id="gradient-accumulation-gradient-release"><a href="#gradient-accumulation-gradient-release" class="header-anchor">#</a> Gradient Accumulation &amp; Gradient Release</h3> <p><strong>Gradient accumulation</strong> reduces the activation memory by splitting a mini-batch into a sequence of micro batches and accumulating the gradients of all micro-batches.</p> <p><strong>Gradient accumulation</strong> must preserve accumulated value of gradients until the last micro-batch.</p> <p><strong>Gradient release</strong> reduces the gradient memory by freeing up the gradient-occupied space in a layer-by-layer manner.</p> <p><strong>Gradient release</strong> releases the gradients immediately after use.</p> <h3 id="adam-accumulation-adama"><a href="#adam-accumulation-adama" class="header-anchor">#</a> Adam Accumulation (AdamA)</h3> <p>Specifically, instead of accumulating gradients, AdamA integrates gradients into optimizer states (m and v in Adam)
immediately after the gradients are produced, and accumulates optimizer states sequentially over micro-batches.</p> <p>This subtle change of directly integrating gradients to optimizer states makes the memory space for whole model gradients no longer needed, eliminating the aforementioned contradiction between preserving gradients and releasing gradients.</p> <p>Consequently, AdamA can reduce the gradient memory to 1/M of the original (M is the number of layers), and the activation memory to 1/N of the original (N is the number of micro-batches).</p> <p><img src="https://github.com/user-attachments/assets/1dfb4486-d838-42d9-a412-5c5f818a2fb8" alt="image"></p> <h3 id="elaboration"><a href="#elaboration" class="header-anchor">#</a> Elaboration</h3> <p>The key idea behind gradient accumulation is to split a mini-batch into several micro-batches.</p> <p>This method computes the gradients of micro-batches sequentially and accumulates them to reduce the memory footprint of activations as well as to keep the same convergence properties as the original mini-batch.</p> <p>Gradient release executes the backward process in a layer-by-layer manner, which immediately releases the gradient-occupied
memory after the weight updating is finished, so that the memory allocated for gradients can be reduced from the size of whole model size to the size of the maximum layer.</p> <h3 id="mechanism"><a href="#mechanism" class="header-anchor">#</a> Mechanism</h3> <p>Intuitively, as gradients are eventually used to update the optimizer states (m and v in Adam), if we can integrate gradients
into optimizer states in advance, the gradients memory can be released, thus resolving this dilemma.</p> <p>Inspired by this insight, we for the first time propose an optimizer accumulation method, namely AdamA, that integrates gradients into optimizer states immediately after produced and then accumulates optimizer states sequentially over micro-batches.</p></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/hitqshao/qishao-notes/edit/main/docs/05.llm/25.llm_optimizer.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2025/04/30, 15:27:06</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/qishao-notes/pages/dc7061/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">LLM Compression</div></a> <a href="/qishao-notes/pages/dc7063/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">LLM Posttraining</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/qishao-notes/pages/dc7061/" class="prev">LLM Compression</a></span> <span class="next"><a href="/qishao-notes/pages/dc7063/">LLM Posttraining</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="https://github.com/hitqshao" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="mailto:hitqshao@163.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://gitee.com/hitqshao" title="Gitee" target="_blank" class="iconfont icon-gitee"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2025
    <span>Eryajf | <a href="https://github.com/hitqshao/qishao-notes/blob/main/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><!----></div></div>
    <script src="/qishao-notes/assets/js/app.b992b4f5.js" defer></script><script src="/qishao-notes/assets/js/2.0833fe67.js" defer></script><script src="/qishao-notes/assets/js/109.a988f42e.js" defer></script>
  </body>
</html>
