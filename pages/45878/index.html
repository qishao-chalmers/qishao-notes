<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>gpu page table walk | CPU &amp; GPU Microarch. Qi Shao</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="stylesheet" href="custom.css">
    <script language="javascript" type="text/javascript" src="/qishao-notes/js/pgmanor-self.js"></script>
    <meta name="description" content="Computer System">
    <meta name="google-site-verification" content="66w5U9NY5gJWu7iBtHKMbhpXkV94jy31L_RHbvrZZzY">
    <meta name="keywords" content="Hitqishao,golang,vue,go-web,go-admin,go-ldap-admin">
    <meta name="theme-color" content="#11a8cd">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <link rel="preload" href="/qishao-notes/assets/css/0.styles.922e50b3.css" as="style"><link rel="preload" href="/qishao-notes/assets/js/app.a708f1e5.js" as="script"><link rel="preload" href="/qishao-notes/assets/js/2.75973713.js" as="script"><link rel="preload" href="/qishao-notes/assets/js/50.fe397638.js" as="script"><link rel="prefetch" href="/qishao-notes/assets/js/10.ff60f5f4.js"><link rel="prefetch" href="/qishao-notes/assets/js/11.35356818.js"><link rel="prefetch" href="/qishao-notes/assets/js/12.97db4364.js"><link rel="prefetch" href="/qishao-notes/assets/js/13.117c9063.js"><link rel="prefetch" href="/qishao-notes/assets/js/14.d32097b1.js"><link rel="prefetch" href="/qishao-notes/assets/js/15.74839805.js"><link rel="prefetch" href="/qishao-notes/assets/js/16.273c8e9e.js"><link rel="prefetch" href="/qishao-notes/assets/js/17.be625961.js"><link rel="prefetch" href="/qishao-notes/assets/js/18.c1ff1604.js"><link rel="prefetch" href="/qishao-notes/assets/js/19.c41dccff.js"><link rel="prefetch" href="/qishao-notes/assets/js/20.51f7fa25.js"><link rel="prefetch" href="/qishao-notes/assets/js/21.b5ba1720.js"><link rel="prefetch" href="/qishao-notes/assets/js/22.aec55c0f.js"><link rel="prefetch" href="/qishao-notes/assets/js/23.00322b09.js"><link rel="prefetch" href="/qishao-notes/assets/js/24.ae95a93e.js"><link rel="prefetch" href="/qishao-notes/assets/js/25.e5add587.js"><link rel="prefetch" href="/qishao-notes/assets/js/26.9a920fc3.js"><link rel="prefetch" href="/qishao-notes/assets/js/27.e8d36ebd.js"><link rel="prefetch" href="/qishao-notes/assets/js/28.07f576d2.js"><link rel="prefetch" href="/qishao-notes/assets/js/29.f587e522.js"><link rel="prefetch" href="/qishao-notes/assets/js/3.f44cb335.js"><link rel="prefetch" href="/qishao-notes/assets/js/30.a830cfc8.js"><link rel="prefetch" href="/qishao-notes/assets/js/31.ffacb210.js"><link rel="prefetch" href="/qishao-notes/assets/js/32.8bbccd2b.js"><link rel="prefetch" href="/qishao-notes/assets/js/33.492fe73d.js"><link rel="prefetch" href="/qishao-notes/assets/js/34.ffcf141e.js"><link rel="prefetch" href="/qishao-notes/assets/js/35.d949676c.js"><link rel="prefetch" href="/qishao-notes/assets/js/36.613f8a8d.js"><link rel="prefetch" href="/qishao-notes/assets/js/37.dc096ab8.js"><link rel="prefetch" href="/qishao-notes/assets/js/38.2817b3b0.js"><link rel="prefetch" href="/qishao-notes/assets/js/39.3132cade.js"><link rel="prefetch" href="/qishao-notes/assets/js/4.424759af.js"><link rel="prefetch" href="/qishao-notes/assets/js/40.a6a3704a.js"><link rel="prefetch" href="/qishao-notes/assets/js/41.533a2027.js"><link rel="prefetch" href="/qishao-notes/assets/js/42.6032efe5.js"><link rel="prefetch" href="/qishao-notes/assets/js/43.bae3965b.js"><link rel="prefetch" href="/qishao-notes/assets/js/44.5d199f6c.js"><link rel="prefetch" href="/qishao-notes/assets/js/45.9425ffca.js"><link rel="prefetch" href="/qishao-notes/assets/js/46.2fd6db52.js"><link rel="prefetch" href="/qishao-notes/assets/js/47.9f2bbdaa.js"><link rel="prefetch" href="/qishao-notes/assets/js/48.55f1d93a.js"><link rel="prefetch" href="/qishao-notes/assets/js/49.a9cd22b9.js"><link rel="prefetch" href="/qishao-notes/assets/js/5.1ec3ed2e.js"><link rel="prefetch" href="/qishao-notes/assets/js/51.7ceac95f.js"><link rel="prefetch" href="/qishao-notes/assets/js/52.7ba47fe9.js"><link rel="prefetch" href="/qishao-notes/assets/js/53.6076cdb7.js"><link rel="prefetch" href="/qishao-notes/assets/js/54.f0662b6a.js"><link rel="prefetch" href="/qishao-notes/assets/js/55.2442ef4b.js"><link rel="prefetch" href="/qishao-notes/assets/js/56.d7d83b44.js"><link rel="prefetch" href="/qishao-notes/assets/js/57.51b34ab2.js"><link rel="prefetch" href="/qishao-notes/assets/js/58.291ef367.js"><link rel="prefetch" href="/qishao-notes/assets/js/59.41afc754.js"><link rel="prefetch" href="/qishao-notes/assets/js/6.13b293c1.js"><link rel="prefetch" href="/qishao-notes/assets/js/60.b3f76948.js"><link rel="prefetch" href="/qishao-notes/assets/js/61.ebe682fa.js"><link rel="prefetch" href="/qishao-notes/assets/js/62.2e6c8aa2.js"><link rel="prefetch" href="/qishao-notes/assets/js/63.b64c2530.js"><link rel="prefetch" href="/qishao-notes/assets/js/64.3e1139a3.js"><link rel="prefetch" href="/qishao-notes/assets/js/65.afd4c9dc.js"><link rel="prefetch" href="/qishao-notes/assets/js/66.12c3bcfd.js"><link rel="prefetch" href="/qishao-notes/assets/js/67.376f973d.js"><link rel="prefetch" href="/qishao-notes/assets/js/68.d36a81f0.js"><link rel="prefetch" href="/qishao-notes/assets/js/69.ff752070.js"><link rel="prefetch" href="/qishao-notes/assets/js/7.8a29f90e.js"><link rel="prefetch" href="/qishao-notes/assets/js/8.9d9bbbd6.js"><link rel="prefetch" href="/qishao-notes/assets/js/9.95b204c9.js">
    <link rel="stylesheet" href="/qishao-notes/assets/css/0.styles.922e50b3.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="ÁõÆÂΩï" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/qishao-notes/" class="home-link router-link-active"><!----> <span class="site-name">CPU &amp; GPU Microarch. Qi Shao</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/qishao-notes/" class="nav-link">Home</a></div><div class="nav-item"><a href="/qishao-notes/hbm/" class="nav-link">hbm</a></div><div class="nav-item"><a href="/qishao-notes/compiler/" class="nav-link">compiler</a></div><div class="nav-item"><a href="/qishao-notes/gpu/" class="nav-link">gpu</a></div><div class="nav-item"><a href="/qishao-notes/cpu/" class="nav-link">cpu</a></div><div class="nav-item"><a href="/qishao-notes/llm/" class="nav-link">llm</a></div><div class="nav-item"><a href="/qishao-notes/unix/" class="nav-link">unix</a></div><div class="nav-item"><a href="/qishao-notes/message-board/" class="nav-link">BBS</a></div><div class="nav-item"><a href="https://blog.csdn.net/hit_shaoqi" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/hitqshao/qishao-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/qishao-notes/" class="nav-link">Home</a></div><div class="nav-item"><a href="/qishao-notes/hbm/" class="nav-link">hbm</a></div><div class="nav-item"><a href="/qishao-notes/compiler/" class="nav-link">compiler</a></div><div class="nav-item"><a href="/qishao-notes/gpu/" class="nav-link">gpu</a></div><div class="nav-item"><a href="/qishao-notes/cpu/" class="nav-link">cpu</a></div><div class="nav-item"><a href="/qishao-notes/llm/" class="nav-link">llm</a></div><div class="nav-item"><a href="/qishao-notes/unix/" class="nav-link">unix</a></div><div class="nav-item"><a href="/qishao-notes/message-board/" class="nav-link">BBS</a></div><div class="nav-item"><a href="https://blog.csdn.net/hit_shaoqi" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/hitqshao/qishao-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/qishao-notes/pages/cc7034/" class="sidebar-link">Operand Collector</a></li><li><a href="/qishao-notes/pages/2476ae/" class="sidebar-link">GPU WARP Scheduler</a></li><li><a href="/qishao-notes/pages/14769f/" class="sidebar-link">Precision Exception</a></li><li><a href="/qishao-notes/pages/44771e/" class="sidebar-link">Unified Memory Paper List</a></li><li><a href="/qishao-notes/pages/44871e/" class="sidebar-link">TensorCore Paper List</a></li><li><a href="/qishao-notes/pages/45871e/" class="sidebar-link">Memory Behaviour Paper List</a></li><li><a href="/qishao-notes/pages/45871f/" class="sidebar-link">GPU Virtualization Paper List</a></li><li><a href="/qishao-notes/pages/458720/" class="sidebar-link">Large Language Model Paper List</a></li><li><a href="/qishao-notes/pages/458721/" class="sidebar-link">GPU Simulator</a></li><li><a href="/qishao-notes/pages/458722/" class="sidebar-link">Architectural Survey</a></li><li><a href="/qishao-notes/pages/458724/" class="sidebar-link">Harnessing Integrated CPU-GPU System Memory for HPC a first look into Grace Hopper</a></li><li><a href="/qishao-notes/pages/458725/" class="sidebar-link">Understanding GPGPU-SIM &amp; GPGPU-SIM UVM_SMART (1)</a></li><li><a href="/qishao-notes/pages/458726/" class="sidebar-link">Understanding GPGPU-SIM &amp; GPGPU-SIM UVM_SMART (2)</a></li><li><a href="/qishao-notes/pages/458727/" class="sidebar-link">Understanding GPGPU-SIM &amp; GPGPU-SIM UVM_SMART (3)</a></li><li><a href="/qishao-notes/pages/45872/" class="sidebar-link">Understanding GPGPU-SIM &amp; GPGPU-SIM UVM_SMART (4)</a></li><li><a href="/qishao-notes/pages/45874/" class="sidebar-link">Understanding GPGPU-SIM &amp; GPGPU-SIM UVM_SMART (5)</a></li><li><a href="/qishao-notes/pages/45873/" class="sidebar-link">Warp Related Memory Optimization</a></li><li><a href="/qishao-notes/pages/45875/" class="sidebar-link">GPU Cache Coherency</a></li><li><a href="/qishao-notes/pages/45876/" class="sidebar-link">GPU Cache &amp; Memory Hirerarchy</a></li><li><a href="/qishao-notes/pages/45877/" class="sidebar-link">GPU TLB</a></li><li><a href="/qishao-notes/pages/45878/" aria-current="page" class="active sidebar-link">gpu page table walk</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/qishao-notes/pages/45878/#contributions" class="sidebar-link">Contributions</a></li><li class="sidebar-sub-header level2"><a href="/qishao-notes/pages/45878/#background" class="sidebar-link">Background</a></li><li class="sidebar-sub-header level2"><a href="/qishao-notes/pages/45878/#address-translation" class="sidebar-link">Address Translation</a></li><li class="sidebar-sub-header level2"><a href="/qishao-notes/pages/45878/#page-fault" class="sidebar-link">Page Fault</a></li><li class="sidebar-sub-header level2"><a href="/qishao-notes/pages/45878/#important-analysis" class="sidebar-link">Important Analysis</a></li><li class="sidebar-sub-header level2"><a href="/qishao-notes/pages/45878/#concluding-remarks" class="sidebar-link">Concluding Remarks</a></li><li class="sidebar-sub-header level2"><a href="/qishao-notes/pages/45878/#background-2" class="sidebar-link">Background</a></li><li class="sidebar-sub-header level2"><a href="/qishao-notes/pages/45878/#introduction" class="sidebar-link">Introduction</a></li><li class="sidebar-sub-header level2"><a href="/qishao-notes/pages/45878/#idea" class="sidebar-link">Idea</a></li></ul></li><li><a href="/qishao-notes/pages/47871e/" class="sidebar-link">TO READ</a></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/qishao-notes/" title="È¶ñÈ°µ" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/qishao-notes/gpu/#gpu" data-v-06225672>gpu</a></li></ul> <div class="info" data-v-06225672><div title="‰ΩúËÄÖ" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/hitqshao" target="_blank" title="‰ΩúËÄÖ" class="beLink" data-v-06225672>hitqishao</a></div> <div title="ÂàõÂª∫Êó∂Èó¥" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2024-08-29</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">ÁõÆÂΩï</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">gpu page table walk<!----></h1> <!----> <div class="theme-vdoing-content content__default"><ol><li>[117 AMD] Observations and Opportunities in Architecting Shared Virtual Memory for Heterogeneous Systems üëç üëç üëç üëç üë¥</li> <li>[68 AMD] Sheduling Page Table Walks for Irregular GPU Applications</li> <li>[7 HPCA] Trans-FW: Short Circuiting Page Table Walk in Multi-GPU Systems via Remote Forwarding</li></ol> <hr> <h1 id="_1-observations-and-opportunities-in-architecting-shared-virtual-memory-for-heterogeneous-systems"><a href="#_1-observations-and-opportunities-in-architecting-shared-virtual-memory-for-heterogeneous-systems" class="header-anchor">#</a> 1. Observations and Opportunities in Architecting Shared Virtual Memory for Heterogeneous Systems</h1> <h2 id="contributions"><a href="#contributions" class="header-anchor">#</a> Contributions</h2> <p>(1) servicing a TLB  miss from the GPU can be an order of magnitude slower than  that from the CPU and consequently it is imperative to enable
many concurrent TLB misses to hide this larger latency;
(2) divergence in memory accesses impacts the GPU‚Äôs address translation more than the rest of the memory hierarchy, and research in designing address translation mechanisms tolerant to this effect is imperative;
(3) page faults from the GPU are considerably slower than that from the CPU and software-hardware  co-design is essential for efficient implementation of page faults from throughput-oriented accelerators like GPUs.</p> <h2 id="background"><a href="#background" class="header-anchor">#</a> Background</h2> <p>The IOMMU resides in the processor‚Äôs northbridge complex.<br>
The IOMMU can access the same x86-64 page table structures used by processes running on the CPU.<br>
This enables the accelerator to share the same set of page tables (and thus the same virtual address space) as the processes running on the CPU via the IOMMU.<br>
A software driver in the OS executing on the CPU manages the IOMMU.<br>
The runtime software, in coordination with the OS driver, sets up the IOMMU to enable accelerators access to the same virtual address spaces of the CPU.</p> <h2 id="address-translation"><a href="#address-translation" class="header-anchor">#</a> Address Translation</h2> <p>The GPU has its own TLB hierarchy that caches recently used address translations.<br>
On a GPU TLB miss, a translation request is sent as an ATS (Address Translation Service [17]) request packet over the PCIe¬Æ-based [27] internal interconnect to the IOMMU.<br> <strong>This interconnect carries PCIe¬Æ packets but latency and bandwidth are not necessarily constrained by PCIe¬Æ‚Äôs electrical specifications</strong>.<br>
The IOMMU has its own TLB hierarchy which is checked first;<br>
on a miss there, a hardware page table walker in the IOMMU checks the page table.<br>
ATS requests are tagged with a process address space identifier (PASID) and the IOMMU maintains a table that matches PASIDs to page table base physical addresses.<br>
Once the address is successfully translated, the IOMMU sends an ATS response to the GPU.<br>
The protocol and packet formats for ATS requests and responses are part of the PCIe¬Æ standard specification and are the same across all accelerators.</p> <p>The PCIe¬Æ‚Äôs ATS protocol enables devices (and accelerators) to prefetch translation requests for up to eight contiguous virtual address pages in a single ATS response from the IOMMU.<br>
By default, the GPU in our system allows the prefetch value to the maximum setting of eight.</p> <p><strong>Comparison with CPUs: In the CPU, per-core Memory management Units (MMUs) are responsible for address translations.<br>
In contrast, the IOMMU services requests from all accelerators.<br>
Unlike the CPU‚Äôs MMU, the IOMMU is not tightly integrated with CPU‚Äôs data cache hierarchy.<br>
The data caches may contain the most up-to-date translations but the cached copies cannot be directly accessed by accelerators.</strong></p> <h2 id="page-fault"><a href="#page-fault" class="header-anchor">#</a> Page Fault</h2> <p>If the IOMMU‚Äôs page table walker fails to find the desired translation in the page table, it sends an ATS response to the GPU notifying it of this failure.<br>
This in turn corresponds to a page fault.<br>
In response, the GPU sends another request to the IOMMU called a Peripheral Page Request (PPR).<br>
The IOMMU places this request in a memory-mapped queue and raises an interrupt on the CPU.<br>
Multiple PPR requests can be queued before the CPU is interrupted.<br>
The OS must have a suitable IOMMU driver to process this interrupt and the queued PPR requests.<br>
In Linux, while in an interrupt context, the driver pulls PPR requests from the queue and places them in a work-queue for later processing. <br>
Presumably this design decision was made to minimize the time spent executing in an interrupt context, where lower priority interrupts would be disabled. <br>
At a later time, an OS worker-thread calls back into the driver to process page fault requests in the work-queue.<br>
Once the requests are serviced, the driver notifies the IOMMU.<br>
In turn, the IOMMU notifies the GPU.<br>
The GPU then sends another ATS request to retry the translation for the original faulting address.</p> <h2 id="important-analysis"><a href="#important-analysis" class="header-anchor">#</a> Important Analysis</h2> <p>We divide the time to handle a GPU page fault into three major parts:<br>
(1) ‚Äúinitialization‚Äù, the latency for the OS driver to read the fault requests from the PPR queue and pre-process it;
(2) ‚Äúprocessing‚Äù, the latency to find a physical page and update the page table;
(3) ‚Äúschedule‚Äù, the time between initialization and processing of a page fault request.
We observe that only <strong>a small fraction of the time is spent in actually processing the work to service a page fault.</strong> <br>
The OS‚Äôs scheduling delay introduced by the asynchronous handling of GPU page faults is the primary contributor to the latency.
<strong>This suggests that page faults from the GPU can be handled more efficiently by modifying the OS driver to handle the faults synchronously whenever possible.</strong></p> <h2 id="concluding-remarks"><a href="#concluding-remarks" class="header-anchor">#</a> Concluding Remarks</h2> <p>Observations and opportunities:</p> <ol><li>Latency of servicing a TLB miss is significantly higher on a GPU than on a CPU (~25).</li> <li>Increasing the number of concurrent page table walks supported by the hardware is key to supporting diverse heterogeneous applications.</li> <li>Half of the programs we studied suffer performance degradation from GPU address translation overheads.</li> <li>Larger pages are effective in reducing TLB misses. Heterogeneous software and hardware should enhance support for larger page sizes.</li> <li>Divergence in memory accesses impacts address translation overhead more than cache and DRAM latency. Research into divergence-tolerant address translation mechanisms for throughput-oriented accelerators is important.</li> <li>Prefetching address translations can degrade performance for programs with poor locality. Applicationdependent translation prefetching is desirable.</li></ol> <p>Observations and opportunities:</p> <ol><li>The latency to service a page fault from the GPU can be significantly higher than from the CPU.</li> <li>Enhancements into system software to handle page faults synchronously can reduce this latency.</li> <li>Software-hardware co-design is needed service a large number of concurrent faults from the GPU/accelerators.</li> <li>It is imperative to scale CPU performance and resources to scale the GPU page fault servicing.</li> <li>Future heterogeneous applications can reduce their physical memory footprints through the use of on-demand page faults from the GPU, although current applications may need to be re-written.</li></ol> <p><img src="https://github.com/user-attachments/assets/f3b7b7a9-6290-4c1d-abc6-dd1c901d5a13" alt="image"></p> <hr> <h1 id="_2-sheduling-page-table-walks-for-irregular-gpu-applications-2018"><a href="#_2-sheduling-page-table-walks-for-irregular-gpu-applications-2018" class="header-anchor">#</a> 2. Sheduling Page Table Walks for Irregular GPU Applications [2018]</h1> <ul><li>better forward progress is achieved by prioritizing translation requests from the instructions that require less work to service their
address translation needs.</li> <li>batching walk requests originating from the same SIMD instruction could reduce unnecessary stalls.</li></ul> <h2 id="background-2"><a href="#background-2" class="header-anchor">#</a> Background</h2> <p>real hardware demonstrated that such divergent memory accesses can slow down an irregular GPU application by up to 3.7-4√ó due to address translation overheads alone [5].<br>
The study found that the negative impact of divergence could be greater on address translation than on the caches.</p> <p>Due to the lack of sufficient spatial locality in such irregular applications, these requests often miss in TLBs, each generating a page table walk request.</p> <p>we show that the order in which page table walk requests are serviced is also critical.</p> <p><em>First</em>, the number of page table walks generated due to the execution of a single SIMD memory instruction can vary widely based on how many distinct pages the instruction accesses and the TLB hits/misses it generates.
a completely divergent SIMD instruction can generate page table walk requests equal to the number of workitems in the wavefront (here, 64).<br> <em>Second</em>, each page walk may itself need anywhere between one to four memory requests to complete.<br>
This happens due to hits/misses in page walk caches (PWCs) that store recently-used upperlevel entries of four-level page tables (d</p> <h2 id="introduction"><a href="#introduction" class="header-anchor">#</a> Introduction</h2> <p><img src="https://github.com/user-attachments/assets/506931a6-b757-4ff1-bbbe-025419796e71" alt="image"></p> <ol><li>An address translation request is generated when executing a SIMD memory instruction (load/store).</li> <li>A coalescer merges multiple requests to the same page (e.g., 4KB) generated by the same SIMD instruction.</li> <li>The coalesced translation request looks up the GPU‚Äôs L1 TLB and then the GPU‚Äôs shared L2 (if L1 misses).</li> <li>On a miss in the GPU‚Äôs L2 TLB, the request is sent to the IOMMU.</li> <li>Upon arrival at the IOMMU, the request looks up the IOMMU‚Äôs TLBs. An IOMMU typically supports multiple independent page table walkers (e.g., 8-16) to concurrently service multiple page table walk requests (TLB misses).</li> <li>On a miss, the request queues up as a page walk request in the IOMMU buffer.</li> <li>When an IOMMU‚Äôs page table walker becomes free, it typically selects a pending request from the IOMMU buffer in FCFS order.</li> <li>The page table walker first performs a PWC <em>(page table walk caches)</em> lookup and then completes the walk of the page table, generating one to four memory accesses.</li> <li>On finishing a walk, the desired translation is returned to the TLBs and ultimately to the SIMD unit that requested it.</li></ol> <h2 id="idea"><a href="#idea" class="header-anchor">#</a> Idea</h2> <p><img src="https://github.com/user-attachments/assets/580b28d0-71f8-428a-852a-514204e070ed" alt="image"></p> <p><img src="https://github.com/user-attachments/assets/56b3c46e-9db9-4b8e-bcf1-7066487b4d51" alt="image"></p></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/hitqshao/qishao-notes/edit/main/docs/03.gpu/21.gpu_ptw.md" target="_blank" rel="noopener noreferrer">Â∏ÆÂä©Êàë‰ª¨ÊîπÂñÑÊ≠§È°µÈù¢</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">‰∏äÊ¨°Êõ¥Êñ∞:</span> <span class="time">2024/08/31, 16:34:48</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/qishao-notes/pages/45877/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">GPU TLB</div></a> <a href="/qishao-notes/pages/47871e/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">TO READ</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ‚Üê
        <a href="/qishao-notes/pages/45877/" class="prev">GPU TLB</a></span> <span class="next"><a href="/qishao-notes/pages/47871e/">TO READ</a>‚Üí
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="https://github.com/hitqshao" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="mailto:hitqshao@163.com" title="ÂèëÈÇÆ‰ª∂" target="_blank" class="iconfont icon-youjian"></a><a href="https://gitee.com/hitqshao" title="Gitee" target="_blank" class="iconfont icon-gitee"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="Êú¨Á´ô‰∏ªÈ¢ò">Vdoing</a> 
    | Copyright ¬© 2022-2024
    <span>Eryajf | <a href="https://github.com/hitqshao/qishao-notes/blob/main/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="ËøîÂõûÈ°∂ÈÉ®" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="ÂéªËØÑËÆ∫" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="‰∏ªÈ¢òÊ®°Âºè" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          Ë∑üÈöèÁ≥ªÁªü
        </li><li class="iconfont icon-rijianmoshi">
          ÊµÖËâ≤Ê®°Âºè
        </li><li class="iconfont icon-yejianmoshi">
          Ê∑±Ëâ≤Ê®°Âºè
        </li><li class="iconfont icon-yuedu">
          ÈòÖËØªÊ®°Âºè
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><!----></div></div>
    <script src="/qishao-notes/assets/js/app.a708f1e5.js" defer></script><script src="/qishao-notes/assets/js/2.75973713.js" defer></script><script src="/qishao-notes/assets/js/50.fe397638.js" defer></script>
  </body>
</html>
